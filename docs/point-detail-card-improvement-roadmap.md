# ν¬μΈνΈ μƒμ„Έ μΉ΄λ“ μ „μ²΄ μ •λ³΄ ν‘μ‹ κ°μ„  λ΅λ“λ§µ

## π“‹ ν„μ¬ μƒνƒ λ¶„μ„

### ν„μ¬ ν‘μ‹λλ” μ •λ³΄
- β… μƒνƒ μ •λ³΄ (μƒνƒ μ•„μ΄μ½, κ±°λ μ ν•, μƒνƒ ν…μ¤νΈ)
- β… μ‹ μ²­ μ •λ³΄ μ„Ήμ…:
  - μ„¤λ… (description)
  - μ‹ μ²­μ (created_by_user_name)
  - μ‹ μ²­μΌμ‹ (created_at)
  - μ²λ¦¬μΌμ‹ (updated_at) - pendingμ΄ μ•„λ‹ λ•λ§
  - μ‹ μ²­ν¬μΈνΈ (point_amount λλ” amount)
  - μ…κΈκΈμ•΅/μ¶κΈκΈμ•΅ (cash_amount) - μμ„ λ•λ§
  - κ±°μ  μ‚¬μ  (rejection_reason) - rejectedμΌ λ•λ§
- β… μμμ¦ μ •λ³΄ μ„Ήμ… (cash κ±°λμΌ λ•λ§)

### ν„μ¬ ν‘μ‹λμ§€ μ•λ” μ •λ³΄
- β κ±°λ ID (id)
- β μ§€κ°‘ ID (wallet_id)
- β κ±°λ μΉ΄ν…κ³ λ¦¬ (transaction_category)
- β μΊ νμΈ ID (campaign_id) - μΊ νμΈ κ±°λμΈ κ²½μ°
- β κ²°μ  λ°©λ²• (payment_method)
- β κ³„μΆ μ •λ³΄ (bank_name, account_number, account_holder) - μ¶κΈμΈ κ²½μ°
- β μ™„λ£μΌμ‹ (completed_at)

### ν¬μΈνΈ μ¤ν¬λ¦° ν‘μ‹ λ¬Έμ 
- β λ¦¬λ·°μ–΄ ν¬μΈνΈ μ¤ν¬λ¦°: μΊμ‹ νΈλμ­μ…(μ¶κΈ)μ΄ ν‘μ‹λμ§€ μ•μ
- β κ΄‘κ³ μ£Ό manager ν¬μΈνΈ μ¤ν¬λ¦°: μΊμ‹ νΈλμ­μ…μ΄ ν‘μ‹λμ§€ μ•μ (μ΅°νλ§ κ°€λ¥ν•λ―€λ΅ ν‘μ‹λμ–΄μ•Ό ν•¨)
- β οΈ λ””ν…μΌ ν™”λ©΄ μ—°κ²°: λ¨λ“  νΈλμ­μ… νƒ€μ…μ—μ„ μ¬λ°”λ¥΄κ² λ™μ‘ν•λ”μ§€ ν™•μΈ ν•„μ”

## π― κ°μ„  λ©ν‘

1. **ν¬μΈνΈ μƒμ„Έ ν™”λ©΄ κ°μ„ **: κ±°λμ™€ κ΄€λ ¨λ λ¨λ“  μ •λ³΄λ¥Ό μ²΄κ³„μ μΌλ΅ ν‘μ‹ν•μ—¬ μ‚¬μ©μκ°€ ν•λμ— μ „μ²΄ μ •λ³΄λ¥Ό ν™•μΈν•  μ μλ„λ΅ κ°μ„ ν•©λ‹λ‹¤.

2. **ν¬μΈνΈ μ¤ν¬λ¦° ν†µν•© κ°μ„ **: λ¦¬λ·°μ–΄μ™€ κ΄‘κ³ μ£Ό ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ μΊμ‹ νΈλμ­μ…(μ…μ¶κΈ)κ³Ό ν¬μΈνΈ νΈλμ­μ…(νλ“/μ†λΉ„)μ΄ λ¨λ‘ μ¬λ°”λ¥΄κ² ν‘μ‹λλ„λ΅ κ°μ„ ν•©λ‹λ‹¤.

3. **λ””ν…μΌ ν™”λ©΄ μ—°κ²° κ²€μ¦**: λ¨λ“  νΈλμ­μ… νƒ€μ…μ—μ„ λ””ν…μΌ ν™”λ©΄μ΄ μ¬λ°”λ¥΄κ² λ™μ‘ν•λ”μ§€ ν™•μΈν•κ³  κ°μ„ ν•©λ‹λ‹¤.

## π“ λ‹¨κ³„λ³„ κµ¬ν„ κ³„ν

### Phase 1: κΈ°λ³Έ κ±°λ μ •λ³΄ μ¶”κ°€ (μ°μ„ μμ„: λ†’μ)

**λ©ν‘**: κ±°λμ κΈ°λ³Έ μ‹λ³„ μ •λ³΄μ™€ λ©”νƒ€λ°μ΄ν„° ν‘μ‹

#### μ‘μ—… λ‚΄μ©
1. **κ±°λ κΈ°λ³Έ μ •λ³΄ μ„Ήμ… μ¶”κ°€**
   - κ±°λ ID (id) - λ³µμ‚¬ κ°€λ¥ν• ν•νƒλ΅ ν‘μ‹
   - μ§€κ°‘ ID (wallet_id) - λ³µμ‚¬ κ°€λ¥ν• ν•νƒλ΅ ν‘μ‹
   - κ±°λ μΉ΄ν…κ³ λ¦¬ (transaction_category) - 'cash' λλ” 'campaign'
   - κ±°λ νƒ€μ… (transaction_type) - λ…μ‹μ μΌλ΅ ν‘μ‹

2. **μΊ νμΈ μ •λ³΄ μ„Ήμ… μ¶”κ°€** (μΊ νμΈ κ±°λμΈ κ²½μ°)
   - μΊ νμΈ ID (campaign_id)
   - μΊ νμΈ μ λ© (campaign_title) - APIλ΅ μ΅°ν ν•„μ”
   - μΊ νμΈ λ§ν¬ (μ„ νƒμ‚¬ν•­)

**μμƒ μ‘μ—… μ‹κ°„**: 2-3μ‹κ°„

**νμΌ μμ •**:
- `lib/screens/mypage/common/point_transaction_detail_screen.dart`

---


### Phase 3: κ²°μ  λ° κ³„μΆ μ •λ³΄ μ¶”κ°€ (μ°μ„ μμ„: μ¤‘κ°„)

**λ©ν‘**: ν„κΈ κ±°λμ κ²°μ  λ°©λ²•κ³Ό κ³„μΆ μ •λ³΄ ν‘μ‹

#### μ‘μ—… λ‚΄μ©
1. **κ²°μ  μ •λ³΄ μ„Ήμ… μ¶”κ°€** (cash κ±°λμΈ κ²½μ°)
   - κ²°μ  λ°©λ²• (payment_method) - 'bank_transfer', 'card' λ“±
   - κ²°μ  λ°©λ²• ν•κΈ€ λ³€ν™ λ΅μ§

2. **κ³„μΆ μ •λ³΄ μ„Ήμ… μ¶”κ°€** (μ¶κΈ κ±°λμΈ κ²½μ°)
   - μ€ν–‰λ… (bank_name)
   - κ³„μΆλ²νΈ (account_number)
   - μκΈμ£Ό (account_holder)

**μμƒ μ‘μ—… μ‹κ°„**: 2-3μ‹κ°„

**νμΌ μμ •**:
- `lib/screens/mypage/common/point_transaction_detail_screen.dart`

---

### Phase 4: μ‹κ°„ μ •λ³΄ λ³΄μ™„ (μ°μ„ μμ„: μ¤‘κ°„)

**λ©ν‘**: κ±°λμ λ¨λ“  μ‹κ°„ μ •λ³΄ ν‘μ‹

#### μ‘μ—… λ‚΄μ©
1. **μ™„λ£μΌμ‹ μ¶”κ°€**
   - μ™„λ£μΌμ‹ (completed_at) - statusκ°€ 'approved' λλ” 'completed'μΌ λ• ν‘μ‹
   - μ²λ¦¬μΌμ‹μ™€ μ™„λ£μΌμ‹ κµ¬λ¶„

2. **μ‹κ°„ μ •λ³΄ μ •λ¦¬**
   - μ‹ μ²­μΌμ‹ (created_at)
   - μ²λ¦¬μΌμ‹ (updated_at) - μƒνƒ λ³€κ²½ μ‹μ 
   - μ™„λ£μΌμ‹ (completed_at) - κ±°λ μ™„λ£ μ‹μ 

**μμƒ μ‘μ—… μ‹κ°„**: 1μ‹κ°„

**νμΌ μμ •**:
- `lib/screens/mypage/common/point_transaction_detail_screen.dart`


### Phase 2: ν¬μΈνΈ μ¤ν¬λ¦° ν†µν•© κ°μ„  (μ°μ„ μμ„: λ†’μ)

**λ©ν‘**: λ¦¬λ·°μ–΄μ™€ κ΄‘κ³ μ£Ό ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ μΊμ‹ νΈλμ­μ…κ³Ό ν¬μΈνΈ νΈλμ­μ…μ΄ λ¨λ‘ μ¬λ°”λ¥΄κ² ν‘μ‹λλ„λ΅ κ°μ„ 

#### ν„μ¬ λ¬Έμ μ 
1. **λ¦¬λ·°μ–΄ ν¬μΈνΈ μ¤ν¬λ¦°** (`/mypage/reviewer/points`)
   - β `getUserPointHistory()`λ§ νΈμ¶ν•μ—¬ ν¬μΈνΈ νΈλμ­μ…λ§ μ΅°ν
   - β μΊμ‹ νΈλμ­μ…(μ¶κΈ)μ΄ ν‘μ‹λμ§€ μ•μ
   - β λ¦¬λ·°μ–΄λ„ μ¶κΈ μ‹ μ²­μ„ ν•  μ μμΌλ―€λ΅ μ¶κΈ λ‚΄μ—­μ΄ ν‘μ‹λμ–΄μ•Ό ν•¨

2. **κ΄‘κ³ μ£Ό ν¬μΈνΈ μ¤ν¬λ¦°** (`/mypage/advertiser/points`)
   - β… owner: `getCompanyPointHistoryUnified()` μ‚¬μ© - μΊμ‹ + ν¬μΈνΈ ν†µν•© μ΅°ν
   - β manager: `getUserPointHistory()`λ§ μ‚¬μ© - ν¬μΈνΈ νΈλμ­μ…λ§ μ΅°ν
   - β οΈ managerλ„ νμ‚¬ μ§€κ°‘μ μΊμ‹ νΈλμ­μ…μ„ λ³Ό μ μμ–΄μ•Ό ν•  μλ„ μμ (μ”κµ¬μ‚¬ν•­ ν™•μΈ ν•„μ”)

3. **λ””ν…μΌ ν™”λ©΄ μ—°κ²°**
   - β οΈ `transaction_category`μ™€ `transaction_type`μ— λ”°λΌ μ¬λ°”λ¥΄κ² μ²λ¦¬λλ”μ§€ ν™•μΈ ν•„μ”
   - β οΈ λ¨λ“  νΈλμ­μ… νƒ€μ…(μ…κΈ, μ¶κΈ, νλ“, μ†λΉ„)μ΄ λ””ν…μΌ ν™”λ©΄μ—μ„ μ¬λ°”λ¥΄κ² ν‘μ‹λλ”μ§€ ν…μ¤νΈ ν•„μ”

#### μ‘μ—… λ‚΄μ©
1. **κ°μΈ μ§€κ°‘μ© ν†µν•© μ΅°ν ν•¨μ μƒμ„±**
   - `get_user_point_history_unified` RPC ν•¨μ μƒμ„± (λλ” κ°λ³„ μ΅°ν ν›„ λ³‘ν•©)
   - ν¬μΈνΈ νΈλμ­μ…(`point_transactions`)κ³Ό μΊμ‹ νΈλμ­μ…(`cash_transactions`) ν†µν•© μ΅°ν
   - λ‚ μ§μ μ •λ ¬ λ° ν†µν•©

2. **λ¦¬λ·°μ–΄ ν¬μΈνΈ μ¤ν¬λ¦° κ°μ„ **
   - ν†µν•© μ΅°ν ν•¨μ μ‚¬μ©ν•λ„λ΅ λ³€κ²½
   - μΊμ‹ νΈλμ­μ…(μ¶κΈ) ν‘μ‹ ν™•μΈ
   - μ…κΈ/μ¶κΈ/νλ“/μ†λΉ„ λ¨λ“  νƒ€μ… ν‘μ‹ ν™•μΈ

3. **κ΄‘κ³ μ£Ό manager ν¬μΈνΈ μ¤ν¬λ¦° κ°μ„ **
   - managerλ” μ΅°νλ§ κ°€λ¥ (μ…κΈ/μ¶κΈ λ²„νΌμ€ ν‘μ‹λμ§€ μ•μ - μ΄λ―Έ κµ¬ν„λ¨)
   - managerλ„ μΊμ‹ νΈλμ­μ…μ„ μ΅°νν•  μ μλ„λ΅ ν†µν•© μ΅°ν ν•¨μ μ‚¬μ©
   - managerμ κ²½μ° νμ‚¬ μ§€κ°‘μ μΊμ‹ νΈλμ­μ…λ„ μ΅°ν κ°€λ¥ν•λ„λ΅ κ°μ„ 
   - `getCompanyPointHistoryUnified()` μ‚¬μ©ν•λ„λ΅ λ³€κ²½ (ownerμ™€ λ™μΌν•κ²)

4. **λ””ν…μΌ ν™”λ©΄ μ—°κ²° ν…μ¤νΈ**
   - λ¨λ“  νΈλμ­μ… νƒ€μ…λ³„ λ””ν…μΌ ν™”λ©΄ λ™μ‘ ν™•μΈ:
     - β… μΊμ‹ μ…κΈ (deposit)
     - β… μΊμ‹ μ¶κΈ (withdraw)
     - β… ν¬μΈνΈ νλ“ (earn)
     - β… ν¬μΈνΈ μ†λΉ„ (spend)
     - β… ν¬μΈνΈ ν™λ¶ (refund)
   - `transaction_category`μ™€ `transaction_type`μ— λ”°λ¥Έ μ¬λ°”λ¥Έ ν‘μ‹ ν™•μΈ
   - `raw_data` μ „λ‹¬μ΄ μ¬λ°”λ¥Έμ§€ ν™•μΈ

5. **λ°μ΄ν„° λ§¤ν•‘ κ²€μ¦**
   - κ° νΈλμ­μ… νƒ€μ…λ³„λ΅ μ¬λ°”λ¥Έ ν•„λ“ λ§¤ν•‘ ν™•μΈ
   - μƒνƒ ν‘μ‹κ°€ μ¬λ°”λ¥Έμ§€ ν™•μΈ
   - κΈμ•΅ ν‘μ‹κ°€ μ¬λ°”λ¥Έμ§€ ν™•μΈ (μ–‘μ/μμ)

**μμƒ μ‘μ—… μ‹κ°„**: 4-6μ‹κ°„

**νμΌ μμ •**:
- `lib/screens/mypage/common/points_screen.dart`
- `lib/services/wallet_service.dart`
- `supabase/migrations/` (RPC ν•¨μ μƒμ„± μ‹)
- `lib/screens/mypage/common/point_transaction_detail_screen.dart` (ν…μ¤νΈ λ° λ²„κ·Έ μμ •)

**ν…μ¤νΈ μ‹λ‚λ¦¬μ¤**:
1. λ¦¬λ·°μ–΄ ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ μ¶κΈ λ‚΄μ—­μ΄ ν‘μ‹λλ”μ§€ ν™•μΈ
2. κ΄‘κ³ μ£Ό owner ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ μ…κΈ/μ¶κΈ/νλ“/μ†λΉ„ λ¨λ‘ ν‘μ‹λλ”μ§€ ν™•μΈ
3. κ΄‘κ³ μ£Ό manager ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ μΊμ‹ νΈλμ­μ…(μ…κΈ/μ¶κΈ)κ³Ό ν¬μΈνΈ νΈλμ­μ…(νλ“/μ†λΉ„) λ¨λ‘ ν‘μ‹λλ”μ§€ ν™•μΈ
4. κ΄‘κ³ μ£Ό manager ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ μ…κΈ/μ¶κΈ λ²„νΌμ΄ ν‘μ‹λμ§€ μ•λ”μ§€ ν™•μΈ (μ΅°νλ§ κ°€λ¥)
5. κ° νΈλμ­μ… νƒ€μ…λ³„ λ””ν…μΌ ν™”λ©΄μ΄ μ¬λ°”λ¥΄κ² ν‘μ‹λλ”μ§€ ν™•μΈ
6. λ””ν…μΌ ν™”λ©΄μ—μ„ λ¨λ“  μ •λ³΄κ°€ μ¬λ°”λ¥΄κ² ν‘μ‹λλ”μ§€ ν™•μΈ

---

## π”§ κΈ°μ μ  κ³ λ ¤μ‚¬ν•­

### 1. λ°μ΄ν„° λ΅λ”©
- μΊ νμΈ μ •λ³΄λ” λ³„λ„ API νΈμ¶ ν•„μ”
- λ΅λ”© μƒνƒ ν‘μ‹ ν•„μ”

### 2. μ„±λ¥ μµμ ν™”
- λ¶ν•„μ”ν• API νΈμ¶ λ°©μ§€
- μΊμ‹± κ³ λ ¤
- μ΅°κ±΄λ¶€ λ΅λ”© (ν•„μ”ν• κ²½μ°μ—λ§ μ΅°ν)

### 3. λ³΄μ•
- κ¶ν•μ— λ”°λ¥Έ μ •λ³΄ ν‘μ‹ μ μ–΄

### 4. μ—λ¬ μ²λ¦¬
- API νΈμ¶ μ‹¤ν¨ μ‹ μ²λ¦¬
- μ‚¬μ©μ μ •λ³΄ μ΅°ν μ‹¤ν¨ μ‹ μ²λ¦¬

## π“ κµ¬ν„ μ°μ„ μμ„ μ”μ•½

| Phase | μ‘μ—… λ‚΄μ© | μ°μ„ μμ„ | μμƒ μ‹κ°„ |
|-------|----------|---------|----------|
| Phase 1 | κΈ°λ³Έ κ±°λ μ •λ³΄ μ¶”κ°€ | λ†’μ | 2-3μ‹κ°„ |
| Phase 2 | ν¬μΈνΈ μ¤ν¬λ¦° ν†µν•© κ°μ„  | λ†’μ | 4-6μ‹κ°„ |
| Phase 3 | κ²°μ  λ° κ³„μΆ μ •λ³΄ μ¶”κ°€ | μ¤‘κ°„ | 2-3μ‹κ°„ |
| Phase 4 | μ‹κ°„ μ •λ³΄ λ³΄μ™„ | μ¤‘κ°„ | 1μ‹κ°„ |

**μ΄ μμƒ μ‹κ°„**: 9-13μ‹κ°„

## β… μ™„λ£ κΈ°μ¤€

κ° Phaseκ°€ μ™„λ£λλ©΄ λ‹¤μμ„ ν™•μΈ:
- [ ] ν•΄λ‹Ή μ •λ³΄κ°€ ν™”λ©΄μ— μ •ν™•ν ν‘μ‹λ¨
- [ ] λ°μ΄ν„°κ°€ μ—†μ„ λ• μ μ ν μ²λ¦¬λ¨
- [ ] μ—λ¬ λ°μƒ μ‹ μ μ ν μ²λ¦¬λ¨
- [ ] UIκ°€ κΉ”λ”ν•κ³  μ½κΈ° μ‰¬μ›€
- [ ] λ¨λ°”μΌκ³Ό λ°μ¤ν¬ν†±μ—μ„ μ •μƒ μ‘λ™

## π“ μ°Έκ³  μ‚¬ν•­

- λ¨λ“  μ •λ³΄λ¥Ό ν• λ²μ— ν‘μ‹ν•μ§€ μ•κ³ , μ„Ήμ…λ³„λ΅ κµ¬λ¶„ν•μ—¬ κ°€λ…μ„± ν–¥μƒ
- μ‚¬μ©μ κ¶ν•μ— λ”°λΌ ν‘μ‹ν•  μ •λ³΄ μ μ–΄ κ°€λ¥ν•λ„λ΅ μ„¤κ³„
- μ ‘κ·Όμ„± κ³ λ ¤ (μ¤ν¬λ¦° λ¦¬λ” μ§€μ› λ“±)

