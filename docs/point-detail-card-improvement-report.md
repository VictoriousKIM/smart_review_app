# ν¬μΈνΈ μƒμ„Έ μΉ΄λ“ κ°μ„  μ‘μ—… κ²°κ³Ό λ³΄κ³ μ„

**μ‘μ—… μΌμ**: 2024λ…„ 12μ›”  
**μ‘μ—… λ²”μ„**: ν¬μΈνΈ μƒμ„Έ ν™”λ©΄ λ° ν¬μΈνΈ μ¤ν¬λ¦° ν†µν•© κ°μ„   
**μ‘μ—… μ‹κ°„**: μ•½ 9-13μ‹κ°„ (μμƒ)

---

## π“‹ μ‘μ—… κ°μ”

ν¬μΈνΈ μƒμ„Έ ν™”λ©΄μ—μ„ κ±°λμ™€ κ΄€λ ¨λ λ¨λ“  μ •λ³΄λ¥Ό μ²΄κ³„μ μΌλ΅ ν‘μ‹ν•κ³ , λ¦¬λ·°μ–΄μ™€ κ΄‘κ³ μ£Ό ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ μΊμ‹ νΈλμ­μ…κ³Ό ν¬μΈνΈ νΈλμ­μ…μ΄ λ¨λ‘ μ¬λ°”λ¥΄κ² ν‘μ‹λλ„λ΅ κ°μ„  μ‘μ—…μ„ μν–‰ν–μµλ‹λ‹¤.

---

## β… μ™„λ£λ μ‘μ—…

### Phase 1: κΈ°λ³Έ κ±°λ μ •λ³΄ μ¶”κ°€ β…

**μ‘μ—… λ‚΄μ©**:
- κ±°λ κΈ°λ³Έ μ •λ³΄ μ„Ήμ… μ¶”κ°€
  - κ±°λ ID (id) - λ³µμ‚¬ κ°€λ¥ν• ν•νƒλ΅ ν‘μ‹
  - μ§€κ°‘ ID (wallet_id) - λ³µμ‚¬ κ°€λ¥ν• ν•νƒλ΅ ν‘μ‹
  - κ±°λ μΉ΄ν…κ³ λ¦¬ (transaction_category) - 'cash' λλ” 'campaign'
  - κ±°λ νƒ€μ… (transaction_type) - λ…μ‹μ μΌλ΅ ν‘μ‹ (μ…κΈ/μ¶κΈ/νλ“/μ†λΉ„/ν™λ¶)
- μΊ νμΈ μ •λ³΄ μ„Ήμ… μ¶”κ°€ (μΊ νμΈ κ±°λμΈ κ²½μ°)
  - μΊ νμΈ ID (campaign_id)
  - μΊ νμΈ μ λ© (campaign_title) - APIλ΅ μ΅°νν•μ—¬ ν‘μ‹

**μμ •λ νμΌ**:
- `lib/screens/mypage/common/point_transaction_detail_screen.dart`

**μ£Όμ” λ³€κ²½μ‚¬ν•­**:
- `CampaignService` import μ¶”κ°€
- `_campaignTitle`, `_isLoadingCampaign` μƒνƒ λ³€μ μ¶”κ°€
- `_loadCampaignInfo()` λ©”μ„λ“ μ¶”κ°€
- `_buildInfoRowWithCopy()` λ©”μ„λ“ μ¶”κ°€ (λ³µμ‚¬ κΈ°λ¥ ν¬ν•¨)
- κ±°λ κΈ°λ³Έ μ •λ³΄ μ„Ήμ… UI μ¶”κ°€
- μΊ νμΈ μ •λ³΄ ν‘μ‹ λ΅μ§ μ¶”κ°€

---

### Phase 2: ν¬μΈνΈ μ¤ν¬λ¦° ν†µν•© κ°μ„  β…

**μ‘μ—… λ‚΄μ©**:
- κ°μΈ μ§€κ°‘μ© ν†µν•© μ΅°ν ν•¨μ μ¶”κ°€
  - `WalletService.getUserPointHistoryUnified()` λ©”μ„λ“ μ¶”κ°€
  - κΈ°μ΅΄ RPC ν•¨μ `get_user_point_history_unified` ν™μ©
- λ¦¬λ·°μ–΄ ν¬μΈνΈ μ¤ν¬λ¦° κ°μ„ 
  - ν†µν•© μ΅°ν ν•¨μ μ‚¬μ©ν•λ„λ΅ λ³€κ²½
  - μΊμ‹ νΈλμ­μ…(μ¶κΈ) ν‘μ‹ κ°€λ¥
  - μ…κΈ/μ¶κΈ/νλ“/μ†λΉ„ λ¨λ“  νƒ€μ… ν‘μ‹
- κ΄‘κ³ μ£Ό manager ν¬μΈνΈ μ¤ν¬λ¦° κ°μ„ 
  - νμ‚¬ μ§€κ°‘μ μΊμ‹ νΈλμ­μ…λ„ μ΅°ν κ°€λ¥ν•λ„λ΅ κ°μ„ 
  - `getCompanyPointHistoryUnified()` μ‚¬μ©ν•λ„λ΅ λ³€κ²½ (ownerμ™€ λ™μΌν•κ²)
  - μ…κΈ/μ¶κΈ λ²„νΌμ€ ν‘μ‹λμ§€ μ•μ (μ΅°νλ§ κ°€λ¥)

**μμ •λ νμΌ**:
- `lib/services/wallet_service.dart`
- `lib/screens/mypage/common/points_screen.dart`

**μ£Όμ” λ³€κ²½μ‚¬ν•­**:
- `WalletService`μ— `getUserPointHistoryUnified()` λ©”μ„λ“ μ¶”κ°€
- λ¦¬λ·°μ–΄ ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ ν†µν•© μ΅°ν ν•¨μ μ‚¬μ©
- κ΄‘κ³ μ£Ό manager ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ νμ‚¬ μ§€κ°‘ ν†µν•© μ΅°ν ν•¨μ μ‚¬μ©
- λ¨λ“  νΈλμ­μ… νƒ€μ…μ— λ€ν• λ°μ΄ν„° λ§¤ν•‘ κ°μ„ 

---

### Phase 3: κ²°μ  λ° κ³„μΆ μ •λ³΄ μ¶”κ°€ β…

**μ‘μ—… λ‚΄μ©**:
- κ²°μ  μ •λ³΄ μ„Ήμ… μ¶”κ°€ (cash κ±°λμΈ κ²½μ°)
  - κ²°μ  λ°©λ²• (payment_method) - 'bank_transfer' β†’ 'κ³„μΆμ΄μ²΄', 'card' β†’ 'μΉ΄λ“'
  - κ²°μ  λ°©λ²• ν•κΈ€ λ³€ν™ λ΅μ§ κµ¬ν„
- κ³„μΆ μ •λ³΄ μ„Ήμ… μ¶”κ°€ (μ¶κΈ κ±°λμΈ κ²½μ°)
  - μ€ν–‰λ… (bank_name)
  - κ³„μΆλ²νΈ (account_number)
  - μκΈμ£Ό (account_holder)

**μμ •λ νμΌ**:
- `lib/screens/mypage/common/point_transaction_detail_screen.dart`

**μ£Όμ” λ³€κ²½μ‚¬ν•­**:
- `_buildPaymentInfoSection()` λ©”μ„λ“ μ¶”κ°€
- κ²°μ  λ°©λ²• ν•κΈ€ λ³€ν™ λ΅μ§ κµ¬ν„
- μ…κΈ/μ¶κΈμ— λ”°λ¥Έ μ΅°κ±΄λ¶€ μ •λ³΄ ν‘μ‹

---

### Phase 4: μ‹κ°„ μ •λ³΄ λ³΄μ™„ β…

**μ‘μ—… λ‚΄μ©**:
- μ™„λ£μΌμ‹ μ¶”κ°€
  - μ™„λ£μΌμ‹ (completed_at) - statusκ°€ 'approved' λλ” 'completed'μΌ λ• ν‘μ‹
  - μ²λ¦¬μΌμ‹μ™€ μ™„λ£μΌμ‹ κµ¬λ¶„

**μμ •λ νμΌ**:
- `lib/screens/mypage/common/point_transaction_detail_screen.dart`

**μ£Όμ” λ³€κ²½μ‚¬ν•­**:
- `completedAt` ν•„λ“ μ¶”μ¶ λ° ν‘μ‹ λ΅μ§ μ¶”κ°€
- μ‹ μ²­μΌμ‹, μ²λ¦¬μΌμ‹, μ™„λ£μΌμ‹ κµ¬λ¶„ν•μ—¬ ν‘μ‹

---

## π“ κ°μ„  κ²°κ³Ό

### μ¶”κ°€λ μ •λ³΄ ν‘μ‹

#### κ±°λ κΈ°λ³Έ μ •λ³΄
- β… κ±°λ ID (λ³µμ‚¬ κ°€λ¥)
- β… μ§€κ°‘ ID (λ³µμ‚¬ κ°€λ¥)
- β… κ±°λ μΉ΄ν…κ³ λ¦¬ (ν„κΈ κ±°λ / μΊ νμΈ κ±°λ)
- β… κ±°λ νƒ€μ… (μ…κΈ/μ¶κΈ/νλ“/μ†λΉ„/ν™λ¶)

#### μΊ νμΈ μ •λ³΄
- β… μΊ νμΈ ID
- β… μΊ νμΈ μ λ© (API μ΅°ν)

#### κ²°μ  λ° κ³„μΆ μ •λ³΄
- β… κ²°μ  λ°©λ²• (μ…κΈμΈ κ²½μ°)
- β… μ€ν–‰λ… (μ¶κΈμΈ κ²½μ°)
- β… κ³„μΆλ²νΈ (μ¶κΈμΈ κ²½μ°)
- β… μκΈμ£Ό (μ¶κΈμΈ κ²½μ°)

#### μ‹κ°„ μ •λ³΄
- β… μ‹ μ²­μΌμ‹
- β… μ²λ¦¬μΌμ‹
- β… μ™„λ£μΌμ‹ (μΉμΈ/μ™„λ£λ κ²½μ°)

### ν¬μΈνΈ μ¤ν¬λ¦° κ°μ„ 

#### λ¦¬λ·°μ–΄ ν¬μΈνΈ μ¤ν¬λ¦°
- β… μΊμ‹ νΈλμ­μ…(μ¶κΈ) ν‘μ‹ κ°€λ¥
- β… ν¬μΈνΈ νΈλμ­μ…(νλ“/μ†λΉ„) ν‘μ‹
- β… λ¨λ“  νΈλμ­μ… νƒ€μ… ν†µν•© ν‘μ‹

#### κ΄‘κ³ μ£Ό ν¬μΈνΈ μ¤ν¬λ¦°
- β… Owner: μΊμ‹ + ν¬μΈνΈ νΈλμ­μ… ν†µν•© ν‘μ‹ (κΈ°μ΅΄ μ μ§€)
- β… Manager: μΊμ‹ + ν¬μΈνΈ νΈλμ­μ… ν†µν•© ν‘μ‹ (κ°μ„ λ¨)
- β… Manager: μ…κΈ/μ¶κΈ λ²„νΌ λ―Έν‘μ‹ (μ΅°νλ§ κ°€λ¥)

---

## π”§ κΈ°μ μ  κµ¬ν„ μ‚¬ν•­

### μƒλ΅μ΄ λ©”μ„λ“

1. **WalletService.getUserPointHistoryUnified()**
   - κ°μΈ μ§€κ°‘μ ν¬μΈνΈ νΈλμ­μ…κ³Ό μΊμ‹ νΈλμ­μ…μ„ ν†µν•© μ΅°ν
   - RPC ν•¨μ `get_user_point_history_unified` ν™μ©

2. **PointTransactionDetailScreen._loadCampaignInfo()**
   - μΊ νμΈ IDλ΅ μΊ νμΈ μ •λ³΄ μ΅°ν
   - CampaignServiceλ¥Ό μ‚¬μ©ν•μ—¬ μΊ νμΈ μ λ© κ°€μ Έμ¤κΈ°

3. **PointTransactionDetailScreen._buildPaymentInfoSection()**
   - κ²°μ  λ° κ³„μΆ μ •λ³΄ μ„Ήμ… UI κµ¬μ„±
   - κ±°λ νƒ€μ…μ— λ”°λ¥Έ μ΅°κ±΄λ¶€ ν‘μ‹

4. **PointTransactionDetailScreen._buildInfoRowWithCopy()**
   - μ •λ³΄ ν–‰ UI + λ³µμ‚¬ κΈ°λ¥
   - κ±°λ ID, μ§€κ°‘ ID λ“±μ— μ‚¬μ©

### λ°μ΄ν„° λ§¤ν•‘ κ°μ„ 

- λ¨λ“  νΈλμ­μ… νƒ€μ…μ— λ€ν• ν†µμΌλ λ°μ΄ν„° λ§¤ν•‘
- `transaction_category`μ™€ `transaction_type`μ— λ”°λ¥Έ μ¬λ°”λ¥Έ ν‘μ‹
- `raw_data` μ „λ‹¬μ„ ν†µν• λ””ν…μΌ ν™”λ©΄ λ°μ΄ν„° μ „λ‹¬

---

## π§ ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

### μ™„λ£λ ν…μ¤νΈ

1. β… λ¦¬λ·°μ–΄ ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ μ¶κΈ λ‚΄μ—­ ν‘μ‹ ν™•μΈ
2. β… κ΄‘κ³ μ£Ό owner ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ μ…κΈ/μ¶κΈ/νλ“/μ†λΉ„ λ¨λ‘ ν‘μ‹ ν™•μΈ
3. β… κ΄‘κ³ μ£Ό manager ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ μΊμ‹ νΈλμ­μ…(μ…κΈ/μ¶κΈ)κ³Ό ν¬μΈνΈ νΈλμ­μ…(νλ“/μ†λΉ„) λ¨λ‘ ν‘μ‹ ν™•μΈ
4. β… κ΄‘κ³ μ£Ό manager ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ μ…κΈ/μ¶κΈ λ²„νΌ λ―Έν‘μ‹ ν™•μΈ (μ΅°νλ§ κ°€λ¥)
5. β… κ° νΈλμ­μ… νƒ€μ…λ³„ λ””ν…μΌ ν™”λ©΄ μ¬λ°”λ¥Έ ν‘μ‹ ν™•μΈ
6. β… λ””ν…μΌ ν™”λ©΄μ—μ„ λ¨λ“  μ •λ³΄ μ¬λ°”λ¥Έ ν‘μ‹ ν™•μΈ

### ν…μ¤νΈ ν•­λ©

- [x] κ±°λ ID λ³µμ‚¬ κΈ°λ¥
- [x] μ§€κ°‘ ID λ³µμ‚¬ κΈ°λ¥
- [x] κ±°λ μΉ΄ν…κ³ λ¦¬ ν‘μ‹
- [x] κ±°λ νƒ€μ… ν‘μ‹
- [x] μΊ νμΈ μ •λ³΄ ν‘μ‹ (μΊ νμΈ κ±°λμΈ κ²½μ°)
- [x] κ²°μ  λ°©λ²• ν‘μ‹ (μ…κΈμΈ κ²½μ°)
- [x] κ³„μΆ μ •λ³΄ ν‘μ‹ (μ¶κΈμΈ κ²½μ°)
- [x] μ™„λ£μΌμ‹ ν‘μ‹ (μΉμΈ/μ™„λ£λ κ²½μ°)
- [x] λ¦¬λ·°μ–΄ ν¬μΈνΈ μ¤ν¬λ¦° ν†µν•© ν‘μ‹
- [x] κ΄‘κ³ μ£Ό manager ν¬μΈνΈ μ¤ν¬λ¦° ν†µν•© ν‘μ‹

---

## π“ λ³€κ²½λ νμΌ λ©λ΅

1. `lib/screens/mypage/common/point_transaction_detail_screen.dart`
   - κ±°λ κΈ°λ³Έ μ •λ³΄ μ„Ήμ… μ¶”κ°€
   - μΊ νμΈ μ •λ³΄ ν‘μ‹ μ¶”κ°€
   - κ²°μ  λ° κ³„μΆ μ •λ³΄ μ„Ήμ… μ¶”κ°€
   - μ™„λ£μΌμ‹ ν‘μ‹ μ¶”κ°€
   - λ³µμ‚¬ κΈ°λ¥ μ¶”κ°€

2. `lib/services/wallet_service.dart`
   - `getUserPointHistoryUnified()` λ©”μ„λ“ μ¶”κ°€

3. `lib/screens/mypage/common/points_screen.dart`
   - λ¦¬λ·°μ–΄ ν¬μΈνΈ μ¤ν¬λ¦° ν†µν•© μ΅°ν μ μ©
   - κ΄‘κ³ μ£Ό manager ν¬μΈνΈ μ¤ν¬λ¦° ν†µν•© μ΅°ν μ μ©

---

## π― λ‹¬μ„±ν• λ©ν‘

1. β… ν¬μΈνΈ μƒμ„Έ ν™”λ©΄μ—μ„ κ±°λμ™€ κ΄€λ ¨λ λ¨λ“  μ •λ³΄λ¥Ό μ²΄κ³„μ μΌλ΅ ν‘μ‹
2. β… λ¦¬λ·°μ–΄μ™€ κ΄‘κ³ μ£Ό ν¬μΈνΈ μ¤ν¬λ¦°μ—μ„ μΊμ‹ νΈλμ­μ…κ³Ό ν¬μΈνΈ νΈλμ­μ…μ΄ λ¨λ‘ μ¬λ°”λ¥΄κ² ν‘μ‹
3. β… λ¨λ“  νΈλμ­μ… νƒ€μ…μ—μ„ λ””ν…μΌ ν™”λ©΄μ΄ μ¬λ°”λ¥΄κ² λ™μ‘

---

## π’΅ ν–¥ν›„ κ°μ„  μ‚¬ν•­

1. **μ„±λ¥ μµμ ν™”**
   - μΊ νμΈ μ •λ³΄ μ΅°ν μ‹ μΊμ‹± κ³ λ ¤
   - λ€λ‰ λ°μ΄ν„° μ΅°ν μ‹ νμ΄μ§€λ„¤μ΄μ… κ°μ„ 

2. **μ‚¬μ©μ κ²½ν— κ°μ„ **
   - λ΅λ”© μƒνƒ ν‘μ‹ κ°μ„ 
   - μ—λ¬ λ©”μ‹μ§€ κ°μ„ 

3. **μ ‘κ·Όμ„± κ°μ„ **
   - μ¤ν¬λ¦° λ¦¬λ” μ§€μ›
   - ν‚¤λ³΄λ“ λ„¤λΉ„κ²μ΄μ… κ°μ„ 

---

## π“ μ°Έκ³  μ‚¬ν•­

- λ¨λ“  μ •λ³΄λ” μ„Ήμ…λ³„λ΅ κµ¬λ¶„ν•μ—¬ κ°€λ…μ„± ν–¥μƒ
- μ‚¬μ©μ κ¶ν•μ— λ”°λΌ ν‘μ‹ν•  μ •λ³΄ μ μ–΄ κ°€λ¥
- κ³„μΆλ²νΈλ” λ³ΈμΈ κ³„μΆμ΄λ―€λ΅ λ§μ¤ν‚Ή μ²λ¦¬ν•μ§€ μ•μ
- λ³µμ‚¬ κΈ°λ¥μ€ κ±°λ ID, μ§€κ°‘ IDμ—λ§ μ μ©

---

**μ‘μ—… μ™„λ£μΌ**: 2024λ…„ 12μ›”  
**μ‘μ—…μ**: AI Assistant  
**κ²€ν†  μƒνƒ**: μ™„λ£

