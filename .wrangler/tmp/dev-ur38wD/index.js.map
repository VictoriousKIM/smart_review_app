{
  "version": 3,
  "sources": ["../bundle-xuGCdD/checked-fetch.js", "../../../workers/index.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-xuGCdD/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-xuGCdD/middleware-loader.entry.ts"],
  "sourceRoot": "D:\\business_project\\smart_grow_project\\smart_review_app\\.wrangler\\tmp\\dev-ur38wD",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "// Cloudflare Workers \uD0C0\uC785 \uC815\uC758\r\ninterface R2Bucket {\r\n  put(key: string, value: ReadableStream | ArrayBuffer | ArrayBufferView | string | null | Blob, options?: R2PutOptions): Promise<R2Object>;\r\n  get(key: string, options?: R2GetOptions): Promise<R2ObjectBody | null>;\r\n  delete(keys: string | string[]): Promise<void>;\r\n}\r\n\r\ninterface R2PutOptions {\r\n  httpMetadata?: {\r\n    contentType?: string;\r\n    contentEncoding?: string;\r\n  };\r\n  customMetadata?: Record<string, string>;\r\n}\r\n\r\ninterface R2GetOptions {\r\n  onlyIf?: {\r\n    etag?: string;\r\n    uploadedBefore?: Date;\r\n    uploadedAfter?: Date;\r\n  };\r\n}\r\n\r\ninterface R2Object {\r\n  key: string;\r\n  version: string;\r\n  size: number;\r\n  etag: string;\r\n  httpEtag: string;\r\n  uploaded: Date;\r\n  httpMetadata?: {\r\n    contentType?: string;\r\n    contentEncoding?: string;\r\n  };\r\n  customMetadata?: Record<string, string>;\r\n}\r\n\r\ninterface R2ObjectBody extends R2Object {\r\n  body: ReadableStream;\r\n  bodyUsed: boolean;\r\n  arrayBuffer(): Promise<ArrayBuffer>;\r\n  text(): Promise<string>;\r\n  json<T = unknown>(): Promise<T>;\r\n  blob(): Promise<Blob>;\r\n}\r\n\r\nexport interface Env {\r\n  FILES: R2Bucket;\r\n  R2_ACCOUNT_ID: string;\r\n  R2_ACCESS_KEY_ID: string;\r\n  R2_SECRET_ACCESS_KEY: string;\r\n  R2_BUCKET_NAME: string;\r\n  R2_PUBLIC_URL: string;\r\n  SUPABASE_URL: string;\r\n  SUPABASE_SERVICE_ROLE_KEY: string;\r\n  GEMINI_API_KEY: string;\r\n  NTS_API_KEY: string;\r\n}\r\n\r\nconst corsHeaders = {\r\n  'Access-Control-Allow-Origin': '*',\r\n  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\r\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n};\r\n\r\nexport default {\r\n  async fetch(request: Request, env: Env): Promise<Response> {\r\n    const url = new URL(request.url);\r\n\r\n    // OPTIONS \uC694\uCCAD \uCC98\uB9AC\r\n    if (request.method === 'OPTIONS') {\r\n      return new Response(null, { headers: corsHeaders });\r\n    }\r\n\r\n    // Health check\r\n    if (url.pathname === '/health') {\r\n      return new Response(\r\n        JSON.stringify({\r\n          status: 'ok',\r\n          timestamp: new Date().toISOString(),\r\n          service: 'smart-review-api',\r\n        }),\r\n        {\r\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n        }\r\n      );\r\n    }\r\n\r\n    // API \uB77C\uC6B0\uD305\r\n    if (url.pathname === '/api/presigned-url' && request.method === 'POST') {\r\n      return handlePresignedUrl(request, env);\r\n    }\r\n\r\n    if (url.pathname === '/api/presigned-url-view' && request.method === 'POST') {\r\n      return handlePresignedUrlForViewing(request, env);\r\n    }\r\n\r\n    if (url.pathname === '/api/upload' && request.method === 'POST') {\r\n      return handleUpload(request, env);\r\n    }\r\n\r\n    if (url.pathname.startsWith('/api/files/') && request.method === 'GET') {\r\n      return handleGetFile(request, env);\r\n    }\r\n\r\n    if (url.pathname === '/api/verify-and-register' && request.method === 'POST') {\r\n      return handleVerifyAndRegister(request, env);\r\n    }\r\n\r\n    if (url.pathname === '/api/delete-file' && request.method === 'POST') {\r\n      return handleDeleteFile(request, env);\r\n    }\r\n\r\n    return new Response(\r\n      JSON.stringify({ error: 'Not Found', path: url.pathname }),\r\n      { status: 404, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n    );\r\n  },\r\n};\r\n\r\nasync function handlePresignedUrlForViewing(request: Request, env: Env): Promise<Response> {\r\n  try {\r\n    const { filePath } = await request.json();\r\n\r\n    if (!filePath) {\r\n      return new Response(\r\n        JSON.stringify({ success: false, error: 'filePath is required' }),\r\n        {\r\n          status: 400,\r\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n        }\r\n      );\r\n    }\r\n\r\n    // Presigned URL \uC0DD\uC131 (\uC870\uD68C\uC6A9, 1\uC2DC\uAC04 \uC720\uD6A8)\r\n    const presignedUrl = await createPresignedUrlSignature(\r\n      'GET',\r\n      filePath,\r\n      'application/octet-stream',\r\n      3600, // 1\uC2DC\uAC04 \uC720\uD6A8\r\n      env\r\n    );\r\n\r\n    return new Response(\r\n      JSON.stringify({\r\n        success: true,\r\n        url: presignedUrl,\r\n        filePath,\r\n        expiresIn: 3600,\r\n        expiresAt: Math.floor(Date.now() / 1000) + 3600,\r\n        method: 'GET',\r\n      }),\r\n      {\r\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n      }\r\n    );\r\n  } catch (error) {\r\n    return new Response(\r\n      JSON.stringify({\r\n        success: false,\r\n        error: error instanceof Error ? error.message : 'Unknown error',\r\n      }),\r\n      {\r\n        status: 500,\r\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\nasync function handlePresignedUrl(request: Request, env: Env): Promise<Response> {\r\n  try {\r\n    const { fileName, userId, contentType, fileType, method = 'PUT' } = await request.json();\r\n\r\n    if (!fileName || !userId || !contentType || !fileType) {\r\n      return new Response(\r\n        JSON.stringify({ success: false, error: 'Missing required fields' }),\r\n        {\r\n          status: 400,\r\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n        }\r\n      );\r\n    }\r\n\r\n    // \uD30C\uC77C \uACBD\uB85C \uC0DD\uC131\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = String(date.getMonth() + 1).padStart(2, '0');\r\n    const day = String(date.getDate()).padStart(2, '0');\r\n    const timestamp = Date.now();\r\n\r\n    const filePath = `${fileType}/${year}/${month}/${day}/${userId}_${timestamp}_${fileName}`;\r\n\r\n    // Presigned URL \uC0DD\uC131 (AWS Signature V4)\r\n    const expiresIn = method === 'GET' ? 3600 : 900; // GET: 1\uC2DC\uAC04, PUT: 15\uBD84\r\n    const presignedUrl = await createPresignedUrlSignature(\r\n      method,\r\n      filePath,\r\n      contentType,\r\n      expiresIn,\r\n      env\r\n    );\r\n\r\n    return new Response(\r\n      JSON.stringify({\r\n        success: true,\r\n        url: presignedUrl,\r\n        filePath,\r\n        expiresIn,\r\n        expiresAt: Math.floor(Date.now() / 1000) + expiresIn,\r\n        method,\r\n      }),\r\n      {\r\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n      }\r\n    );\r\n  } catch (error) {\r\n    return new Response(\r\n      JSON.stringify({\r\n        success: false,\r\n        error: error instanceof Error ? error.message : 'Unknown error',\r\n      }),\r\n      {\r\n        status: 500,\r\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\n// AWS Signature V4\uB97C \uC0AC\uC6A9\uD55C Presigned URL \uC0DD\uC131\r\nasync function createPresignedUrlSignature(\r\n  method: string,\r\n  filePath: string,\r\n  contentType: string,\r\n  expiresIn: number,\r\n  env: Env\r\n): Promise<string> {\r\n  const region = 'auto';\r\n  const service = 's3';\r\n  const algorithm = 'AWS4-HMAC-SHA256';\r\n  \r\n  const url = `https://${env.R2_ACCOUNT_ID}.r2.cloudflarestorage.com/${env.R2_BUCKET_NAME}/${filePath}`;\r\n  const urlObj = new URL(url);\r\n  const date = new Date();\r\n  const dateStamp = date.toISOString().slice(0, 10).replace(/-/g, '');\r\n  const amzDate = date.toISOString().replace(/[:\\-]|\\.\\d{3}/g, '');\r\n  \r\n  // Query string parameters\r\n  const queryParams = new URLSearchParams({\r\n    'X-Amz-Algorithm': algorithm,\r\n    'X-Amz-Credential': `${env.R2_ACCESS_KEY_ID}/${dateStamp}/${region}/${service}/aws4_request`,\r\n    'X-Amz-Date': amzDate,\r\n    'X-Amz-Expires': expiresIn.toString(),\r\n    'X-Amz-SignedHeaders': 'host',\r\n  });\r\n  \r\n  // Canonical Request\r\n  const canonicalHeaders = `host:${urlObj.host}\\n`;\r\n  const signedHeaders = 'host';\r\n  const canonicalRequest = [\r\n    method,\r\n    urlObj.pathname,\r\n    queryParams.toString(),\r\n    canonicalHeaders,\r\n    signedHeaders,\r\n    'UNSIGNED-PAYLOAD'\r\n  ].join('\\n');\r\n  \r\n  // String to Sign\r\n  const credentialScope = `${dateStamp}/${region}/${service}/aws4_request`;\r\n  const hashedCanonicalRequest = await sha256(canonicalRequest);\r\n  const stringToSign = [\r\n    algorithm,\r\n    amzDate,\r\n    credentialScope,\r\n    hashedCanonicalRequest\r\n  ].join('\\n');\r\n  \r\n  // \uC11C\uBA85 \uC0DD\uC131\r\n  const kSecret = `AWS4${env.R2_SECRET_ACCESS_KEY}`;\r\n  const kDate = await hmacSha256Binary(kSecret, dateStamp);\r\n  const kRegion = await hmacSha256Binary(kDate, region);\r\n  const kService = await hmacSha256Binary(kRegion, service);\r\n  const kSigning = await hmacSha256Binary(kService, 'aws4_request');\r\n  \r\n  const signatureBuffer = await hmacSha256Binary(kSigning, stringToSign);\r\n  const signature = Array.from(signatureBuffer)\r\n    .map(b => b.toString(16).padStart(2, '0'))\r\n    .join('');\r\n  \r\n  // Presigned URL \uC0DD\uC131\r\n  queryParams.set('X-Amz-Signature', signature);\r\n  return `${url}?${queryParams.toString()}`;\r\n}\r\n\r\nasync function sha256(data: string): Promise<string> {\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(data));\r\n  return Array.from(new Uint8Array(hashBuffer))\r\n    .map(b => b.toString(16).padStart(2, '0'))\r\n    .join('');\r\n}\r\n\r\nasync function hmacSha256Binary(key: string | Uint8Array, data: string): Promise<Uint8Array> {\r\n  const keyBuffer = typeof key === 'string' ? new TextEncoder().encode(key) : new Uint8Array(key);\r\n  const dataBuffer = new TextEncoder().encode(data);\r\n  \r\n  const cryptoKey = await crypto.subtle.importKey(\r\n    'raw',\r\n    keyBuffer.buffer,\r\n    { name: 'HMAC', hash: 'SHA-256' },\r\n    false,\r\n    ['sign']\r\n  );\r\n  \r\n  const signature = await crypto.subtle.sign('HMAC', cryptoKey, dataBuffer);\r\n  return new Uint8Array(signature);\r\n}\r\n\r\nasync function handleUpload(request: Request, env: Env): Promise<Response> {\r\n  try {\r\n    const formData = await request.formData();\r\n    const file = formData.get('file') as File;\r\n    const userId = formData.get('userId') as string;\r\n    const fileType = formData.get('fileType') as string;\r\n\r\n    if (!file || !userId || !fileType) {\r\n      return new Response(\r\n        JSON.stringify({ success: false, error: 'Missing required fields' }),\r\n        {\r\n          status: 400,\r\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n        }\r\n      );\r\n    }\r\n\r\n    // \uD30C\uC77C \uACBD\uB85C \uC0DD\uC131\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = String(date.getMonth() + 1).padStart(2, '0');\r\n    const day = String(date.getDate()).padStart(2, '0');\r\n    const timestamp = Date.now();\r\n\r\n    const key = `${fileType}/${year}/${month}/${day}/${userId}_${timestamp}_${file.name}`;\r\n\r\n    // R2\uC5D0 \uC5C5\uB85C\uB4DC\r\n    await env.FILES.put(key, file.stream(), {\r\n      httpMetadata: {\r\n        contentType: file.type,\r\n      },\r\n      customMetadata: {\r\n        userId,\r\n        fileType,\r\n        uploadedAt: new Date().toISOString(),\r\n      },\r\n    });\r\n\r\n    const publicUrl = `${env.R2_PUBLIC_URL}/${key}`;\r\n\r\n    return new Response(\r\n      JSON.stringify({\r\n        success: true,\r\n        url: publicUrl,\r\n        key,\r\n      }),\r\n      {\r\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n      }\r\n    );\r\n  } catch (error) {\r\n    return new Response(\r\n      JSON.stringify({\r\n        success: false,\r\n        error: error instanceof Error ? error.message : 'Unknown error',\r\n      }),\r\n      {\r\n        status: 500,\r\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\nasync function handleGetFile(request: Request, env: Env): Promise<Response> {\r\n  try {\r\n    const url = new URL(request.url);\r\n    const key = url.pathname.replace('/api/files/', '');\r\n\r\n    if (!key) {\r\n      return new Response(\r\n        JSON.stringify({ error: 'File key is required' }),\r\n        {\r\n          status: 400,\r\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n        }\r\n      );\r\n    }\r\n\r\n    const object = await env.FILES.get(key);\r\n    if (!object) {\r\n      return new Response(\r\n        JSON.stringify({ error: 'File not found' }),\r\n        {\r\n          status: 404,\r\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n        }\r\n      );\r\n    }\r\n\r\n    const headers = new Headers(corsHeaders);\r\n    headers.set('Content-Type', object.httpMetadata?.contentType || 'application/octet-stream');\r\n    if (object.httpMetadata?.contentEncoding) {\r\n      headers.set('Content-Encoding', object.httpMetadata.contentEncoding);\r\n    }\r\n\r\n    return new Response(object.body, { headers });\r\n  } catch (error) {\r\n    return new Response(\r\n      JSON.stringify({\r\n        error: error instanceof Error ? error.message : 'Unknown error',\r\n      }),\r\n      {\r\n        status: 500,\r\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\n// ============================================\r\n// \uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D \uAC80\uC99D \uBC0F \uB4F1\uB85D \uD1B5\uD569 \uCC98\uB9AC\r\n// ============================================\r\n\r\ninterface VerifyAndRegisterRequest {\r\n  image: string; // base64 \uC778\uCF54\uB529\uB41C \uC774\uBBF8\uC9C0\r\n  fileName: string;\r\n  userId: string;\r\n}\r\n\r\ninterface VerifyAndRegisterResponse {\r\n  success: boolean;\r\n  extractedData?: any;\r\n  validationResult?: any;\r\n  presignedUrl?: string;\r\n  filePath?: string;\r\n  publicUrl?: string;\r\n  error?: string;\r\n  step?: string;\r\n  debugInfo?: any;\r\n}\r\n\r\nasync function handleVerifyAndRegister(request: Request, env: Env): Promise<Response> {\r\n  try {\r\n    let requestData: VerifyAndRegisterRequest;\r\n    \r\n    try {\r\n      requestData = await request.json();\r\n    } catch (jsonError) {\r\n      console.error('\u274C JSON \uD30C\uC2F1 \uC2E4\uD328:', jsonError);\r\n      return new Response(\r\n        JSON.stringify({ \r\n          success: false, \r\n          error: `\uC694\uCCAD \uB370\uC774\uD130 \uD30C\uC2F1 \uC2E4\uD328: ${jsonError instanceof Error ? jsonError.message : String(jsonError)}`,\r\n          debugInfo: {\r\n            contentType: request.headers.get('content-type'),\r\n            hasBody: !!request.body,\r\n          }\r\n        }),\r\n        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n      );\r\n    }\r\n\r\n    const { image, fileName, userId } = requestData;\r\n\r\n    // \uD544\uC218 \uD544\uB4DC \uAC80\uC99D\r\n    const missingFields: string[] = [];\r\n    if (!image) missingFields.push('image');\r\n    if (!fileName) missingFields.push('fileName');\r\n    if (!userId) missingFields.push('userId');\r\n\r\n    if (missingFields.length > 0) {\r\n      console.error('\u274C \uD544\uC218 \uD544\uB4DC \uB204\uB77D:', missingFields);\r\n      return new Response(\r\n        JSON.stringify({ \r\n          success: false, \r\n          error: `Missing required fields: ${missingFields.join(', ')}`,\r\n          debugInfo: {\r\n            receivedFields: {\r\n              hasImage: !!image,\r\n              imageLength: image ? image.length : 0,\r\n              fileName: fileName || null,\r\n              userId: userId || null,\r\n            }\r\n          }\r\n        }),\r\n        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n      );\r\n    }\r\n\r\n    let extractedData: any = null;\r\n    let validationResult: any = null;\r\n\r\n    try {\r\n      // 0\uB2E8\uACC4: \uC774\uBBF8\uC9C0 \uAC80\uC99D\r\n      const isBusinessRegistration = await verifyBusinessRegistrationImage(image, env);\r\n      if (!isBusinessRegistration) {\r\n        return new Response(\r\n          JSON.stringify({\r\n            success: false,\r\n            error: '\uC5C5\uB85C\uB4DC\uB41C \uC774\uBBF8\uC9C0\uAC00 \uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D\uC774 \uC544\uB2D9\uB2C8\uB2E4.',\r\n            step: 'image_verification',\r\n          }),\r\n          { status: 200, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n        );\r\n      }\r\n\r\n      // 1\uB2E8\uACC4: AI \uCD94\uCD9C\r\n      try {\r\n        extractedData = await extractBusinessInfo(image, env);\r\n        if (!extractedData.business_number) {\r\n          throw new Error(`\uC0AC\uC5C5\uC790\uB4F1\uB85D\uBC88\uD638\uB97C \uCD94\uCD9C\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uCD94\uCD9C\uB41C \uB370\uC774\uD130: ${JSON.stringify(extractedData)}`);\r\n        }\r\n      } catch (extractError) {\r\n        const errorMessage = extractError instanceof Error ? extractError.message : String(extractError);\r\n        console.error('\u274C AI \uCD94\uCD9C \uC2E4\uD328:', errorMessage);\r\n        throw new Error(`AI \uCD94\uCD9C \uC2E4\uD328: ${errorMessage}`);\r\n      }\r\n\r\n      // 2\uB2E8\uACC4: \uC0AC\uC5C5\uC790\uB4F1\uB85D\uBC88\uD638 \uAC80\uC99D\r\n      validationResult = await validateBusinessNumber(extractedData.business_number, env);\r\n      if (!validationResult.isValid) {\r\n        return new Response(\r\n          JSON.stringify({\r\n            success: false,\r\n            extractedData,\r\n            validationResult,\r\n            error: validationResult.errorMessage || '\uC720\uD6A8\uD558\uC9C0 \uC54A\uC740 \uC0AC\uC5C5\uC790\uB4F1\uB85D\uBC88\uD638\uC785\uB2C8\uB2E4.',\r\n            step: 'validation',\r\n          }),\r\n          { status: 200, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n        );\r\n      }\r\n\r\n      // 3\uB2E8\uACC4: Presigned URL \uC0DD\uC131 (Flutter\uC5D0\uC11C \uC9C1\uC811 \uC5C5\uB85C\uB4DC)\r\n      const contentType = fileName.toLowerCase().endsWith('.pdf') ? 'application/pdf' : 'image/png';\r\n      const filePath = generateFilePath(userId, fileName);\r\n      const presignedUrl = await createPresignedUrlSignature(\r\n        'PUT',\r\n        filePath,\r\n        contentType,\r\n        900, // 15\uBD84 \uC720\uD6A8\r\n        env\r\n      );\r\n\r\n      // DB \uC800\uC7A5\uC740 Flutter\uC5D0\uC11C \uCC98\uB9AC\uD558\uB3C4\uB85D \uBCC0\uACBD\r\n      // Workers\uB294 \uAC80\uC99D\uACFC Presigned URL \uC0DD\uC131\uB9CC \uC218\uD589\r\n      return new Response(\r\n        JSON.stringify({\r\n          success: true,\r\n          extractedData,\r\n          validationResult,\r\n          presignedUrl,\r\n          filePath,\r\n          publicUrl: `${env.R2_PUBLIC_URL}/${filePath}`,\r\n          // DB \uC800\uC7A5\uC740 Flutter\uC5D0\uC11C \uCC98\uB9AC\r\n        }),\r\n        { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n      );\r\n    } catch (error) {\r\n      // Presigned URL \uC0DD\uC131 \uD6C4 \uC5D0\uB7EC \uBC1C\uC0DD \uC2DC \uBCC4\uB3C4 \uB864\uBC31 \uBD88\uD544\uC694\r\n      // (\uD30C\uC77C\uC774 \uC544\uC9C1 \uC5C5\uB85C\uB4DC\uB418\uC9C0 \uC54A\uC558\uC73C\uBBC0\uB85C)\r\n      return new Response(\r\n        JSON.stringify({\r\n          success: false,\r\n          extractedData: extractedData || undefined,\r\n          validationResult: validationResult || undefined,\r\n          error: error instanceof Error ? error.message : String(error),\r\n          step: validationResult ? 'presigned_url' : extractedData ? 'validation' : 'extraction',\r\n          debugInfo: {\r\n            errorType: error instanceof Error ? error.constructor.name : typeof error,\r\n            errorStack: error instanceof Error ? error.stack : undefined,\r\n            timestamp: new Date().toISOString(),\r\n          },\r\n        }),\r\n        { status: 200, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n      );\r\n    }\r\n  } catch (error) {\r\n    console.error('\u274C handleVerifyAndRegister \uC804\uCCB4 \uC624\uB958:', error);\r\n    return new Response(\r\n      JSON.stringify({\r\n        success: false,\r\n        error: error instanceof Error ? error.message : 'Unknown error',\r\n        debugInfo: {\r\n          errorType: error instanceof Error ? error.constructor.name : typeof error,\r\n          errorStack: error instanceof Error ? error.stack : undefined,\r\n          timestamp: new Date().toISOString(),\r\n        },\r\n      }),\r\n      { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n    );\r\n  }\r\n}\r\n\r\n// \uD5EC\uD37C \uD568\uC218\uB4E4\r\nasync function callGeminiAPI(apiKey: string, model: string, image: string, prompt: string): Promise<Response> {\r\n  if (!apiKey || apiKey.trim() === '') {\r\n    throw new Error('GEMINI_API_KEY\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.');\r\n  }\r\n\r\n  console.log(`\uD83D\uDD11 Gemini API \uD638\uCD9C: \uBAA8\uB378=${model}, API \uD0A4 \uAE38\uC774=${apiKey.length}, \uC2DC\uC791=${apiKey.substring(0, 10)}...`);\r\n  \r\n  const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;\r\n  \r\n  return await fetch(url, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({\r\n      contents: [{\r\n        parts: [\r\n          { text: prompt },\r\n          { inline_data: { mime_type: 'image/png', data: image } }\r\n        ]\r\n      }],\r\n      generationConfig: { temperature: 0.1, maxOutputTokens: 1000 },\r\n    }),\r\n  });\r\n}\r\n\r\nasync function verifyBusinessRegistrationImage(image: string, env: Env): Promise<boolean> {\r\n  // API \uD0A4 \uAC80\uC99D\r\n  if (!env.GEMINI_API_KEY || env.GEMINI_API_KEY.trim() === '') {\r\n    console.error('\u274C GEMINI_API_KEY\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.');\r\n    return true; // \uC5C4\uACA9\uD558\uC9C0 \uC54A\uAC8C \uCC98\uB9AC\r\n  }\r\n\r\n  const verificationPrompt = `\uC774 \uC774\uBBF8\uC9C0\uAC00 \uD55C\uAD6D\uC758 \uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D\uC778\uC9C0 \uD655\uC778\uD574\uC8FC\uC138\uC694.\r\n\r\n\uB2E4\uC74C\uACFC \uAC19\uC740 \uC694\uC18C\uAC00 \uC788\uB294\uC9C0 \uD655\uC778\uD558\uC138\uC694:\r\n- \"\uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D\" \uB610\uB294 \"\uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D\uBA85\uC6D0\" \uD14D\uC2A4\uD2B8\r\n- \uC0AC\uC5C5\uC790\uB4F1\uB85D\uBC88\uD638 (000-00-00000 \uD615\uC2DD \uB610\uB294 10\uC790\uB9AC \uC22B\uC790)\r\n- \uC0C1\uD638\uBA85, \uB300\uD45C\uC790\uBA85, \uC0AC\uC5C5\uC7A5\uC18C\uC7AC\uC9C0 \uB4F1\uC758 \uC815\uBCF4\r\n- \uC815\uBD80 \uAE30\uAD00 \uC778\uC99D \uB9C8\uD06C\uB098 \uB3C4\uC7A5\r\n- \uAD6D\uC138\uCCAD \uB610\uB294 \uC138\uBB34\uC11C \uAD00\uB828 \uD45C\uC2DC\r\n\r\n\uB2E4\uC74C\uACFC \uAC19\uC740 \uACBD\uC6B0\uC5D0\uB3C4 \uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D\uC73C\uB85C \uC778\uC815\uD569\uB2C8\uB2E4:\r\n- \uC2A4\uCE94\uBCF8, \uC0AC\uC9C4, PDF \uB4F1 \uB2E4\uC591\uD55C \uD615\uC2DD\r\n- \uC77C\uBD80\uAC00 \uAC00\uB824\uC9C0\uAC70\uB098 \uD750\uB9BF\uD55C \uACBD\uC6B0\r\n- \uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D\uBA85\uC6D0(\uC778\uC1C4\uBCF8)\uB3C4 \uD3EC\uD568\r\n- \uC624\uB798\uB41C \uD615\uC2DD\uC758 \uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D\uB3C4 \uD3EC\uD568\r\n\r\n\uC751\uB2F5\uC740 \uB2E4\uC74C \uD615\uC2DD\uC758 JSON\uB9CC \uBC18\uD658\uD574\uC8FC\uC138\uC694:\r\n{\r\n  \"is_business_registration\": true \uB610\uB294 false,\r\n  \"confidence\": \"high\" \uB610\uB294 \"medium\" \uB610\uB294 \"low\",\r\n  \"reason\": \"\uD655\uC778 \uC774\uC720\"\r\n}\r\n\r\n\uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D\uC774 \uD655\uC2E4\uD55C \uACBD\uC6B0 \"is_business_registration\": true\uB85C \uC124\uC815\uD558\uACE0, \r\n\uC758\uC2EC\uC2A4\uB7EC\uC6B4 \uACBD\uC6B0\uC5D0\uB3C4 \uAC00\uB2A5\uC131\uC774 \uC788\uC73C\uBA74 true\uB85C \uC124\uC815\uD574\uC8FC\uC138\uC694. \r\n\uBA85\uD655\uD788 \uB2E4\uB978 \uBB38\uC11C(\uC2E0\uBD84\uC99D, \uACC4\uC57D\uC11C \uB4F1)\uC778 \uACBD\uC6B0\uC5D0\uB9CC false\uB85C \uC124\uC815\uD574\uC8FC\uC138\uC694.`;\r\n\r\n  try {\r\n    const geminiResponse = await callGeminiAPI(env.GEMINI_API_KEY, 'gemini-2.5-flash', image, verificationPrompt);\r\n    if (!geminiResponse.ok) {\r\n      console.error('\u274C Gemini API \uD638\uCD9C \uC2E4\uD328:', geminiResponse.status);\r\n      // API \uD638\uCD9C \uC2E4\uD328 \uC2DC\uC5D0\uB3C4 true \uBC18\uD658 (\uC5C4\uACA9\uD558\uC9C0 \uC54A\uAC8C)\r\n      return true;\r\n    }\r\n\r\n    const geminiData = await geminiResponse.json();\r\n    const extractedText = geminiData.candidates?.[0]?.content?.parts?.[0]?.text;\r\n    if (!extractedText) {\r\n      console.warn('\u26A0\uFE0F \uC751\uB2F5 \uD14D\uC2A4\uD2B8 \uC5C6\uC74C, \uD5C8\uC6A9\uC73C\uB85C \uCC98\uB9AC');\r\n      return true;\r\n    }\r\n\r\n    try {\r\n      const jsonMatch = extractedText.match(/```json\\s*([\\s\\S]*?)\\s*```/) || \r\n                       extractedText.match(/```\\s*([\\s\\S]*?)\\s*```/) ||\r\n                       [null, extractedText];\r\n      const result = JSON.parse(jsonMatch[1] || extractedText);\r\n      const isBusinessRegistration = result.is_business_registration === true;\r\n      const confidence = result.confidence || 'low';\r\n      \r\n      console.log('\uD83D\uDCCB \uC774\uBBF8\uC9C0 \uAC80\uC99D \uACB0\uACFC:', {\r\n        isBusinessRegistration,\r\n        confidence,\r\n        reason: result.reason\r\n      });\r\n\r\n      // confidence\uAC00 low\uC778 \uACBD\uC6B0\uB3C4 \uD5C8\uC6A9 (\uC5C4\uACA9\uD558\uC9C0 \uC54A\uAC8C)\r\n      if (isBusinessRegistration) {\r\n        return true;\r\n      }\r\n\r\n      // false\uC778 \uACBD\uC6B0\uC5D0\uB3C4 \uD0A4\uC6CC\uB4DC \uD655\uC778\uC73C\uB85C \uC7AC\uAC80\uC99D\r\n      if (extractedText.toLowerCase().includes('\uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D') || \r\n          extractedText.toLowerCase().includes('business registration') ||\r\n          extractedText.toLowerCase().includes('\uC0AC\uC5C5\uC790\uB4F1\uB85D\uBC88\uD638')) {\r\n        console.log('\u2705 \uD0A4\uC6CC\uB4DC \uD655\uC778\uC73C\uB85C \uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D\uC73C\uB85C \uC778\uC815');\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    } catch (parseError) {\r\n      console.error('\u274C JSON \uD30C\uC2F1 \uC2E4\uD328, \uD14D\uC2A4\uD2B8 \uD655\uC778:', parseError);\r\n      // \uD30C\uC2F1 \uC2E4\uD328 \uC2DC \uD14D\uC2A4\uD2B8\uC5D0\uC11C \uD0A4\uC6CC\uB4DC \uD655\uC778 (\uB354 \uAD00\uB300\uD558\uAC8C)\r\n      const lowerText = extractedText.toLowerCase();\r\n      if (lowerText.includes('\uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D') || \r\n          lowerText.includes('business registration') ||\r\n          lowerText.includes('\uC0AC\uC5C5\uC790\uB4F1\uB85D\uBC88\uD638') ||\r\n          lowerText.includes('\uC0AC\uC5C5\uC790') ||\r\n          lowerText.includes('\uB4F1\uB85D\uBC88\uD638')) {\r\n        console.log('\u2705 \uD0A4\uC6CC\uB4DC \uD655\uC778\uC73C\uB85C \uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D\uC73C\uB85C \uC778\uC815');\r\n        return true;\r\n      }\r\n      // \uD30C\uC2F1 \uC2E4\uD328 \uC2DC\uC5D0\uB3C4 \uC5C4\uACA9\uD558\uC9C0 \uC54A\uAC8C true \uBC18\uD658\r\n      console.warn('\u26A0\uFE0F \uD30C\uC2F1 \uC2E4\uD328, \uD5C8\uC6A9\uC73C\uB85C \uCC98\uB9AC');\r\n      return true;\r\n    }\r\n  } catch (error) {\r\n    console.error('\u274C \uC774\uBBF8\uC9C0 \uAC80\uC99D \uC911 \uC624\uB958:', error);\r\n    // \uC5D0\uB7EC \uBC1C\uC0DD \uC2DC\uC5D0\uB3C4 \uC5C4\uACA9\uD558\uC9C0 \uC54A\uAC8C true \uBC18\uD658\r\n    console.warn('\u26A0\uFE0F \uC5D0\uB7EC \uBC1C\uC0DD, \uD5C8\uC6A9\uC73C\uB85C \uCC98\uB9AC');\r\n    return true;\r\n  }\r\n}\r\n\r\nasync function extractBusinessInfo(image: string, env: Env): Promise<any> {\r\n  const extractionPrompt = `\uC774 \uD55C\uAD6D \uC0AC\uC5C5\uC790\uB4F1\uB85D\uC99D \uC774\uBBF8\uC9C0\uB97C \uBD84\uC11D\uD558\uC5EC \uB2E4\uC74C \uC815\uBCF4\uB97C JSON \uD615\uD0DC\uB85C \uCD94\uCD9C\uD574\uC8FC\uC138\uC694: business_name, business_number, representative_name, business_address, business_type, business_item`;\r\n\r\n  // API \uD0A4 \uAC80\uC99D\r\n  if (!env.GEMINI_API_KEY || env.GEMINI_API_KEY.trim() === '') {\r\n    throw new Error('GEMINI_API_KEY \uD658\uACBD \uBCC0\uC218\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. Workers secrets\uC5D0 GEMINI_API_KEY\uB97C \uC124\uC815\uD574\uC8FC\uC138\uC694.');\r\n  }\r\n\r\n  const models = ['gemini-2.5-flash-lite', 'gemini-2.5-flash'];\r\n  const errors: string[] = [];\r\n  \r\n  for (let i = 0; i < models.length; i++) {\r\n    const model = models[i];\r\n    try {\r\n      console.log(`\uD83D\uDD04 ${model} \uBAA8\uB378\uB85C AI \uCD94\uCD9C \uC2DC\uB3C4 \uC911...`);\r\n      const geminiResponse = await callGeminiAPI(env.GEMINI_API_KEY, model, image, extractionPrompt);\r\n      \r\n      if (!geminiResponse.ok) {\r\n        const errorText = await geminiResponse.text();\r\n        let errorMsg = `${model} API \uD638\uCD9C \uC2E4\uD328 (${geminiResponse.status}): ${errorText}`;\r\n        \r\n        // 403 \uC5D0\uB7EC\uC778 \uACBD\uC6B0 \uD2B9\uBCC4 \uCC98\uB9AC\r\n        if (geminiResponse.status === 403) {\r\n          const errorJson = JSON.parse(errorText);\r\n          if (errorJson.error?.message?.includes('unregistered callers')) {\r\n            errorMsg = `${model} API \uD0A4 \uC778\uC99D \uC2E4\uD328 (403): API \uD0A4\uAC00 \uC720\uD6A8\uD558\uC9C0 \uC54A\uAC70\uB098 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. Workers secrets\uC5D0\uC11C GEMINI_API_KEY\uB97C \uD655\uC778\uD574\uC8FC\uC138\uC694.`;\r\n          }\r\n        }\r\n        \r\n        console.error(`\u274C ${errorMsg}`);\r\n        errors.push(errorMsg);\r\n        if (i === models.length - 1) {\r\n          throw new Error(`\uBAA8\uB4E0 \uBAA8\uB378 \uC2E4\uD328. \uB9C8\uC9C0\uB9C9 \uC5D0\uB7EC: ${errorMsg}`);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      const geminiData = await geminiResponse.json();\r\n      const extractedText = geminiData.candidates?.[0]?.content?.parts?.[0]?.text;\r\n      \r\n      if (!extractedText) {\r\n        const errorMsg = `${model}: \uC751\uB2F5 \uD14D\uC2A4\uD2B8 \uC5C6\uC74C`;\r\n        console.error(`\u274C ${errorMsg}`);\r\n        errors.push(errorMsg);\r\n        if (i === models.length - 1) {\r\n          throw new Error(`\uBAA8\uB4E0 \uBAA8\uB378 \uC2E4\uD328. \uB9C8\uC9C0\uB9C9 \uC5D0\uB7EC: ${errorMsg}`);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      console.log(`\u2705 ${model} \uC751\uB2F5 \uD14D\uC2A4\uD2B8 \uAE38\uC774: ${extractedText.length}\uC790`);\r\n\r\n      try {\r\n        const jsonMatch = extractedText.match(/```json\\s*([\\s\\S]*?)\\s*```/) || \r\n                         extractedText.match(/```\\s*([\\s\\S]*?)\\s*```/) ||\r\n                         [null, extractedText];\r\n        const jsonText = jsonMatch[1] || extractedText;\r\n        const result = JSON.parse(jsonText);\r\n        \r\n        console.log(`\u2705 ${model} \uCD94\uCD9C \uC131\uACF5:`, result);\r\n        \r\n        // \uC0AC\uC5C5\uC790\uB4F1\uB85D\uBC88\uD638\uAC00 \uC788\uB294\uC9C0 \uD655\uC778\r\n        if (!result.business_number) {\r\n          console.warn(`\u26A0\uFE0F ${model}: \uC0AC\uC5C5\uC790\uB4F1\uB85D\uBC88\uD638\uAC00 \uCD94\uCD9C\uB418\uC9C0 \uC54A\uC74C. \uCD94\uCD9C\uB41C \uB370\uC774\uD130:`, result);\r\n        }\r\n        \r\n        return result;\r\n      } catch (parseError) {\r\n        const errorMsg = `${model} JSON \uD30C\uC2F1 \uC2E4\uD328: ${parseError instanceof Error ? parseError.message : String(parseError)}. \uC751\uB2F5 \uD14D\uC2A4\uD2B8: ${extractedText.substring(0, 200)}...`;\r\n        console.error(`\u274C ${errorMsg}`);\r\n        errors.push(errorMsg);\r\n        \r\n        // \uD30C\uC2F1 \uC2E4\uD328 \uC2DC \uD14D\uC2A4\uD2B8\uC5D0\uC11C \uC815\uBCF4 \uCD94\uCD9C \uC2DC\uB3C4\r\n        try {\r\n          const patterns = {\r\n            business_name: /\uC0C1\uD638[:\\s]*([^\\n\\r]+)/i,\r\n            business_number: /\uB4F1\uB85D\uBC88\uD638[:\\s]*([0-9-]+)/i,\r\n            representative_name: /\uC131\uBA85[:\\s]*([^\\n\\r]+)/i,\r\n            business_address: /\uC0AC\uC5C5\uC7A5\uC18C\uC7AC\uC9C0[:\\s]*([^\\n\\r]+)/i,\r\n            business_type: /\uC5C5\uD0DC[:\\s]*([^\\n\\r]+)/i,\r\n            business_item: /\uC885\uBAA9[:\\s]*([^\\n\\r]+)/i,\r\n          };\r\n          \r\n          const fallbackData: Record<string, string> = {};\r\n          for (const [key, pattern] of Object.entries(patterns)) {\r\n            const match = extractedText.match(pattern);\r\n            if (match && match[1]) {\r\n              fallbackData[key] = match[1].trim();\r\n            }\r\n          }\r\n          \r\n          if (fallbackData.business_number) {\r\n            console.log(`\u2705 ${model} \uD14D\uC2A4\uD2B8 \uD328\uD134\uC73C\uB85C \uCD94\uCD9C \uC131\uACF5:`, fallbackData);\r\n            return fallbackData;\r\n          }\r\n        } catch (fallbackError) {\r\n          console.error(`\u274C ${model} \uD14D\uC2A4\uD2B8 \uD328\uD134 \uCD94\uCD9C\uB3C4 \uC2E4\uD328:`, fallbackError);\r\n        }\r\n        \r\n        if (i === models.length - 1) {\r\n          throw new Error(`\uBAA8\uB4E0 \uBAA8\uB378 \uC2E4\uD328. JSON \uD30C\uC2F1 \uC2E4\uD328. \uC5D0\uB7EC\uB4E4: ${errors.join('; ')}`);\r\n        }\r\n        continue;\r\n      }\r\n    } catch (error) {\r\n      const errorMsg = `${model} \uBAA8\uB378 \uCC98\uB9AC \uC911 \uC608\uC678 \uBC1C\uC0DD: ${error instanceof Error ? error.message : String(error)}`;\r\n      console.error(`\u274C ${errorMsg}`);\r\n      errors.push(errorMsg);\r\n      \r\n      if (i === models.length - 1) {\r\n        throw new Error(`AI \uCD94\uCD9C \uC2E4\uD328. \uBAA8\uB4E0 \uBAA8\uB378 \uC2DC\uB3C4 \uC2E4\uD328. \uC5D0\uB7EC\uB4E4: ${errors.join('; ')}`);\r\n      }\r\n      continue;\r\n    }\r\n  }\r\n  \r\n  throw new Error(`AI \uCD94\uCD9C \uC2E4\uD328. \uC54C \uC218 \uC5C6\uB294 \uC624\uB958. \uC5D0\uB7EC\uB4E4: ${errors.join('; ')}`);\r\n}\r\n\r\nfunction validateChecksum(businessNumber: string): boolean {\r\n  const cleanNumber = businessNumber.replaceAll('-', '');\r\n  if (cleanNumber.length !== 10) return false;\r\n\r\n  const weights = [1, 3, 7, 1, 3, 7, 1, 3, 5];\r\n  let sum = 0;\r\n  for (let i = 0; i < 9; i++) {\r\n    sum += parseInt(cleanNumber[i]) * weights[i];\r\n  }\r\n  sum += Math.floor((parseInt(cleanNumber[8]) * 5) / 10);\r\n  const remainder = sum % 10;\r\n  const checkDigit = remainder === 0 ? 0 : 10 - remainder;\r\n  return checkDigit === parseInt(cleanNumber[9]);\r\n}\r\n\r\nasync function validateBusinessNumber(businessNumber: string, env: Env): Promise<any> {\r\n  const cleanNumber = businessNumber.replaceAll('-', '');\r\n  if (!/^\\d{10}$/.test(cleanNumber) || !validateChecksum(cleanNumber)) {\r\n    return { isValid: false, errorMessage: '\uC0AC\uC5C5\uC790\uB4F1\uB85D\uBC88\uD638 \uD615\uC2DD\uC774 \uC62C\uBC14\uB974\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.' };\r\n  }\r\n\r\n  const response = await fetch(\r\n    `https://api.odcloud.kr/api/nts-businessman/v1/status?serviceKey=${env.NTS_API_KEY}`,\r\n    {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },\r\n      body: JSON.stringify({ b_no: [cleanNumber] }),\r\n    }\r\n  );\r\n\r\n  if (!response.ok) {\r\n    const errorText = await response.text();\r\n    console.error('\u274C \uAD6D\uC138\uCCAD API \uC5D0\uB7EC \uC751\uB2F5:', {\r\n      status: response.status,\r\n      statusText: response.statusText,\r\n      body: errorText,\r\n      businessNumber: cleanNumber,\r\n    });\r\n    throw new Error(`\uAD6D\uC138\uCCAD API \uD638\uCD9C \uC2E4\uD328: ${response.status} - ${errorText}`);\r\n  }\r\n\r\n  const jsonData = await response.json();\r\n  const statusCode = jsonData.status_code || '';\r\n  const data = jsonData.data || [];\r\n\r\n  if (statusCode === 'OK' && data.length > 0) {\r\n    const businessInfo = data[0];\r\n    return {\r\n      isValid: businessInfo.b_stt_cd === '01',\r\n      businessStatus: businessInfo.b_stt || '',\r\n      businessStatusCode: businessInfo.b_stt_cd,\r\n      taxType: businessInfo.tax_type || '',\r\n    };\r\n  }\r\n\r\n  return { isValid: false, errorMessage: '\uC0AC\uC5C5\uC790 \uC815\uBCF4\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.' };\r\n}\r\n\r\nfunction generateFilePath(userId: string, fileName: string): string {\r\n  const now = new Date();\r\n  const year = now.getFullYear();\r\n  const month = String(now.getMonth() + 1).padStart(2, '0');\r\n  const day = String(now.getDate()).padStart(2, '0');\r\n  const timestamp = now.getTime();\r\n  const extension = fileName.substring(fileName.lastIndexOf('.'));\r\n  return `business-registration/${year}/${month}/${day}/${userId}_${timestamp}${extension}`;\r\n}\r\n\r\nasync function uploadBusinessRegistrationFile(\r\n  fileBytes: Uint8Array,\r\n  filePath: string,\r\n  contentType: string,\r\n  userId: string,\r\n  env: Env\r\n): Promise<string> {\r\n  await env.FILES.put(filePath, fileBytes, {\r\n    httpMetadata: { contentType },\r\n    customMetadata: { userId, fileType: 'business_registration', uploadedAt: new Date().toISOString() },\r\n  });\r\n  return `${env.R2_PUBLIC_URL}/${filePath}`;\r\n}\r\n\r\n// DB \uC800\uC7A5\uC740 Flutter\uC5D0\uC11C \uCC98\uB9AC\uD558\uBBC0\uB85C \uC81C\uAC70\uB428\r\n\r\n// \uD30C\uC77C \uC0AD\uC81C API (DB \uC800\uC7A5 \uC2E4\uD328 \uC2DC \uB864\uBC31\uC6A9)\r\ninterface DeleteFileRequest {\r\n  fileUrl: string;\r\n}\r\n\r\nasync function handleDeleteFile(request: Request, env: Env): Promise<Response> {\r\n  try {\r\n    const requestData: DeleteFileRequest = await request.json();\r\n    const { fileUrl } = requestData;\r\n\r\n    if (!fileUrl) {\r\n      return new Response(\r\n        JSON.stringify({ success: false, error: 'fileUrl\uC774 \uD544\uC694\uD569\uB2C8\uB2E4.' }),\r\n        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n      );\r\n    }\r\n\r\n    // R2 Public URL\uC5D0\uC11C \uD30C\uC77C \uACBD\uB85C \uCD94\uCD9C\r\n    // \uC608: https://7b72031b240604b8e9f88904de2f127c.r2.cloudflarestorage.com/business-registration/2025/11/02/userId_timestamp.png\r\n    const urlObj = new URL(fileUrl);\r\n    const filePath = urlObj.pathname.substring(1); // \uCCAB \uBC88\uC9F8 '/' \uC81C\uAC70\r\n\r\n    if (!filePath.startsWith('business-registration/')) {\r\n      return new Response(\r\n        JSON.stringify({ success: false, error: '\uC720\uD6A8\uD558\uC9C0 \uC54A\uC740 \uD30C\uC77C \uACBD\uB85C\uC785\uB2C8\uB2E4.' }),\r\n        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n      );\r\n    }\r\n\r\n    // R2\uC5D0\uC11C \uD30C\uC77C \uC0AD\uC81C\r\n    await env.FILES.delete(filePath);\r\n\r\n    return new Response(\r\n      JSON.stringify({ success: true, message: '\uD30C\uC77C\uC774 \uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.' }),\r\n      { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n    );\r\n  } catch (error) {\r\n    console.error('\u274C \uD30C\uC77C \uC0AD\uC81C \uC2E4\uD328:', error);\r\n    return new Response(\r\n      JSON.stringify({\r\n        success: false,\r\n        error: error instanceof Error ? error.message : '\uD30C\uC77C \uC0AD\uC81C \uC2E4\uD328',\r\n      }),\r\n      { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n    );\r\n  }\r\n}\r\n\r\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"D:\\\\business_project\\\\smart_grow_project\\\\smart_review_app\\\\workers\\\\index.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"D:\\\\business_project\\\\smart_grow_project\\\\smart_review_app\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"D:\\\\business_project\\\\smart_grow_project\\\\smart_review_app\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"D:\\\\business_project\\\\smart_grow_project\\\\smart_review_app\\\\workers\\\\index.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"D:\\\\business_project\\\\smart_grow_project\\\\smart_review_app\\\\.wrangler\\\\tmp\\\\bundle-xuGCdD\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"D:\\\\business_project\\\\smart_grow_project\\\\smart_review_app\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"D:\\\\business_project\\\\smart_grow_project\\\\smart_review_app\\\\.wrangler\\\\tmp\\\\bundle-xuGCdD\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"D:\\\\business_project\\\\smart_grow_project\\\\smart_review_app\\\\.wrangler\\\\tmp\\\\bundle-xuGCdD\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": ["jsonError"]
}
