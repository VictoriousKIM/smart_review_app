---
alwaysApply: true
---

## ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

### ì‹œë“œ ë°ì´í„° ë¤í”„
```bash
npx supabase db dump --local --data-only -f supabase/seed.sql
```

### ë§ˆì´ê·¸ë ˆì´ì…˜ ê´€ë¦¬
```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì••ì¶•
npx supabase migration squash

# ë¡œì»¬ ëŒ€ì‹œë³´ë“œ ë³€ê²½ì‚¬í•­ ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
npx supabase db diff -f <migration_name>

# ìŠ¤í‚¤ë§ˆ ë³€ê²½ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
npx supabase db diff --local --schema public -f supabase/migrations/YYYYMMDDHHMMSS_description.sql
```

## Cloudflare Workers ì„¤ì •

**íŒŒì¼**: `lib/config/supabase_config.dart`

### ë¡œì»¬ ê°œë°œ
```dart
static const String workersApiUrl = 'http://localhost:8787';
```

```bash
cd workers
npx wrangler dev --remote  # âš ï¸ --remote í•„ìˆ˜ (í”„ë¡œë•ì…˜ R2 ì‚¬ìš©)
```

### í”„ë¡œë•ì…˜
```dart
static const String workersApiUrl = 'https://smart-review-api.nightkille.workers.dev';
```

**ì¤‘ìš”:**
- ë¡œì»¬: `http://localhost:8787` ì‚¬ìš©, `--remote` í”Œë˜ê·¸ë¡œ í”„ë¡œë•ì…˜ R2 ì—°ê²°
- í”„ë¡œë•ì…˜ ë°°í¬: `npx wrangler deploy` (í”„ë¡œì íŠ¸ ë£¨íŠ¸)

## Git ì»¤ë°‹ ë©”ì‹œì§€

**ì˜ì–´ë¡œ ì‘ì„±** (PowerShell í˜¸í™˜ì„±)
```bash
git commit -m "feat: add point cancellation feature

- Add cancel cash transaction RPC function
- Update UI to show cancel button for pending transactions"
```

ì»¤ë°‹ íƒ€ì…: `feat`, `fix`, `chore`, `refactor`, `docs`, `style`, `test`

## Flutter ì›¹ ì•± ì ‘ê·¼ì„± í™œì„±í™”

```javascript
await page.evaluate(() => {
  const button = document.querySelector('flt-semantics-placeholder[aria-label="Enable accessibility"]');
  if (button) button.click();
});
```

## ë¬¸ì„œ ì‘ì„± ê·œì¹™

ë³´ê³ ì„œ ì‘ì„± ì‹œ **í˜„ì¬ ë‚ ì§œ í™•ì¸ í›„ ì‚¬ìš©**:
```bash
powershell -Command "Get-Date -Format 'yyyyë…„ MMì›” ddì¼'"
```

ë‚ ì§œ í˜•ì‹: `yyyyë…„ MMì›” ddì¼` (ì˜ˆ: 2025ë…„ 11ì›” 24ì¼)

## Flutter ì›¹ ì•± ì´ë¯¸ì§€ ì—…ë¡œë“œ

1. ì´ë¯¸ì§€ íŒŒì¼ì„ ì›¹ ì„œë²„ì— ë³µì‚¬:
```bash
powershell -Command "Copy-Item 'ì´ë¯¸ì§€íŒŒì¼.png' -Destination 'web/' -Force"
```

2. Playwrightë¡œ íŒŒì¼ ì„¤ì •:
```javascript
await page.locator('button:has-text("ì´ë¯¸ì§€ ì„ íƒ")').click();
await page.waitForTimeout(1000);

const response = await fetch('http://localhost:3001/ì´ë¯¸ì§€íŒŒì¼.png');
const blob = await response.blob();
const file = new File([blob], 'ì´ë¯¸ì§€íŒŒì¼.png', { type: 'image/png' });

const fileInput = document.querySelector('input[type="file"]');
const dataTransfer = new DataTransfer();
dataTransfer.items.add(file);
fileInput.files = dataTransfer.files;
fileInput.dispatchEvent(new Event('change', { bubbles: true }));
```

## DateTime ì²˜ë¦¬ (KST ê¸°ì¤€)

**ì›ì¹™**: ëª¨ë“  DateTimeì€ í•œêµ­ ì‹œê°„(KST, UTC+9) ê¸°ì¤€, DBëŠ” UTC ì €ì¥

```dart
import '../../utils/date_time_utils.dart';

// í˜„ì¬ ì‹œê°„
final now = DateTimeUtils.nowKST();

// DateTime ìƒì„±
final dateTime = DateTimeUtils.nowKST().copyWith(
  year: date.year, month: date.month, day: date.day,
  hour: time.hour, minute: time.minute, second: 0, millisecond: 0,
);

// DB ì €ì¥
'p_apply_start_date': DateTimeUtils.toIso8601StringKST(applyStartDate),

// DB ì½ê¸°
applyStartDate: json['apply_start_date'] != null
    ? DateTimeUtils.parseKST(json['apply_start_date'])
    : DateTimeUtils.nowKST().add(const Duration(days: 1)),

// ì‹œê°„ ë¹„êµ
final now = DateTimeUtils.nowKST();
_pendingCampaigns = _allCampaigns.where((c) => c.applyStartDate.isAfter(now)).toList();

// í‘œì‹œ
Text(DateTimeUtils.formatKST(dateTime)) // "2025-11-25 14:30"
```

**ê¸ˆì§€**: `DateTime.now()`, `.toLocal()`, `.toIso8601String()` ì§ì ‘ ì‚¬ìš©

## Custom JWT ì„¸ì…˜ ì§€ì› (ë„¤ì´ë²„ ë¡œê·¸ì¸)

**ì›ì¹™**: ë„¤ì´ë²„ ë¡œê·¸ì¸ì€ Custom JWT ì„¸ì…˜ ì‚¬ìš© â†’ `supabase.auth.currentUser`ê°€ `null`ì¼ ìˆ˜ ìˆìŒ

### âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
```dart
import 'auth_service.dart';

// ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸°
final userId = await AuthService.getCurrentUserId();
if (userId == null) {
  throw Exception('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
}

// RPC í•¨ìˆ˜ í˜¸ì¶œ
final response = await _supabase.rpc(
  'some_rpc_function',
  params: {'p_user_id': userId, ...},
);

// ì§ì ‘ ì¿¼ë¦¬
final response = await _supabase
    .from('some_table')
    .select()
    .eq('user_id', userId);
```

### âŒ ê¸ˆì§€
```dart
// âŒ currentUser ì§ì ‘ ì‚¬ìš©
final user = _supabase.auth.currentUser;
final userId = _supabase.auth.currentUser?.id;
final session = _supabase.auth.currentSession;
```

**ì¤‘ìš”**: ëª¨ë“  ì„œë¹„ìŠ¤ ë©”ì„œë“œì—ì„œ `AuthService.getCurrentUserId()` ì‚¬ìš© í•„ìˆ˜

## ë³´ì•ˆ ë° ë°ì´í„° ì ‘ê·¼ ì œì–´

**ì›ì¹™**: í”„ë¡ íŠ¸ì—”ë“œ ë³´ì•ˆ ë¡œì§ ê¸ˆì§€ â†’ ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ ì²˜ë¦¬ (RLS + RPC)

### âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
```dart
// RPC í•¨ìˆ˜ ì‚¬ìš©
final data = await Service.getDataByUserId(userId);
```

### âŒ ê¸ˆì§€
```dart
// í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì—­í•  ì²´í¬ í›„ ë°ì´í„° ì ‘ê·¼
if (role != 'owner') return null;
final data = await supabase.from('table').select();
```

### RPC í•¨ìˆ˜ ìƒì„± ê·œì¹™
```sql
CREATE OR REPLACE FUNCTION "public"."function_name"(
    "p_user_id" "uuid" DEFAULT NULL::"uuid"
)
    LANGUAGE "plpgsql" SECURITY DEFINER
    SET "search_path" TO ''  -- í•„ìˆ˜: ë³´ì•ˆ ê°•í™”
    AS $$
DECLARE
    v_user_id UUID := COALESCE(p_user_id, auth.uid());
    v_role TEXT;
BEGIN
    SELECT company_role INTO v_role FROM public.company_users ...;
    IF v_role NOT IN ('owner', 'manager') THEN RETURN; END IF;
    RETURN QUERY SELECT ...;
END;
$$;
```

**í—ˆìš©**: UI/UX ëª©ì ì˜ í”„ë¡ íŠ¸ì—”ë“œ ì²´í¬ë§Œ (ë²„íŠ¼ í™œì„±í™”, ìœ„ì ¯ í‘œì‹œ)

## ë°˜ì‘í˜• ë””ìì¸ (ResponsiveBuilder)

**ì›ì¹™**: ëª¨ë“  ìƒˆ ìŠ¤í¬ë¦°ì€ ResponsiveBuilder í•„ìˆ˜ ì‚¬ìš©

### ê¸°ë³¸ êµ¬ì¡°
```dart
import 'package:responsive_builder/responsive_builder.dart';

@override
Widget build(BuildContext context) {
  return Scaffold(
    body: ResponsiveBuilder(
      builder: (context, sizingInformation) {
        return SingleChildScrollView(
          padding: getValueForScreenType<EdgeInsets>(
            context: context,
            mobile: const EdgeInsets.all(16),
            tablet: const EdgeInsets.symmetric(horizontal: 40, vertical: 20),
            desktop: const EdgeInsets.symmetric(horizontal: 60, vertical: 30),
          ),
          child: Center(
            child: ConstrainedBox(
              constraints: BoxConstraints(
                maxWidth: getValueForScreenType<double>(
                  context: context,
                  mobile: double.infinity,
                  tablet: 700,
                  desktop: 900,
                ),
              ),
              child: Column(children: [...]),
            ),
          ),
        );
      },
    ),
  );
}
```

**2. ê³µí†µ ìœ„ì ¯ í™œìš©**
```dart
// ResponsiveHelper ì‚¬ìš©
import '../../utils/responsive_helper.dart';

final padding = ResponsiveHelper.responsivePadding(
  context: context,
  mobile: const EdgeInsets.all(16),
  tablet: const EdgeInsets.all(24),
  desktop: const EdgeInsets.all(32),
);

// ResponsiveScreen ì‚¬ìš© (ê°„ë‹¨í•œ ê²½ìš°)
import '../../widgets/responsive_screen.dart';

body: ResponsiveScreen(
  mobile: MobileLayout(),
  tablet: TabletLayout(),
  desktop: DesktopLayout(),
  maxWidth: 1200,
)
```

**3. ë°˜ì‘í˜• ê°’ ê¸°ì¤€**

| í™”ë©´ íƒ€ì… | ë„ˆë¹„ ë²”ìœ„ | íŒ¨ë”© (ì¼ë°˜) | íŒ¨ë”© (í¼) | ìµœëŒ€ ë„ˆë¹„ (ì¼ë°˜) | ìµœëŒ€ ë„ˆë¹„ (í¼) |
|---------|---------|-----------|---------|--------------|-------------|
| Mobile | < 600px | 16-24px | 16px | ë¬´ì œí•œ | ë¬´ì œí•œ |
| Tablet | 600-1200px | 40px (horizontal) | 40px (horizontal) | 800-1200px | 700px |
| Desktop | > 1200px | 60-100px (horizontal) | 100px (horizontal) | 1200-1400px | 900px |

### âŒ ì˜ëª»ëœ ë°©ë²•

```dart
// âŒ ì˜ëª»: ê³ ì •ëœ íŒ¨ë”© ì‚¬ìš©
body: SingleChildScrollView(
  padding: const EdgeInsets.all(16),  // âŒ ëª¨ë“  í™”ë©´ í¬ê¸°ì—ì„œ ë™ì¼
  child: Column(...),
)

// âŒ ì˜ëª»: ResponsiveBuilder ì—†ì´ ê°œë°œ
@override
Widget build(BuildContext context) {
  return Scaffold(
    body: Column(...),  // âŒ ë°˜ì‘í˜• ì§€ì› ì—†ìŒ
  );
}

// âŒ ì˜ëª»: MediaQueryë§Œ ì‚¬ìš© (ì¼ê´€ì„± ì—†ìŒ)
final isMobile = MediaQuery.of(context).size.width < 600;
final padding = isMobile ? 16.0 : 40.0;  // âŒ í‘œì¤€ íŒ¨í„´ ë¯¸ì¤€ìˆ˜
```

### ğŸ“‹ ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸

ìƒˆë¡œìš´ ìŠ¤í¬ë¦°ì„ ê°œë°œí•  ë•Œ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

1. âœ… `ResponsiveBuilder`ë¡œ bodyë¥¼ ê°ì‹¸ëŠ”ê°€?
2. âœ… `getValueForScreenType`ì„ ì‚¬ìš©í•˜ì—¬ ë°˜ì‘í˜• ê°’ì„ ì„¤ì •í•˜ëŠ”ê°€?
3. âœ… í‘œì¤€ íŒ¨ë”© ê°’ì„ ì‚¬ìš©í•˜ëŠ”ê°€? (Mobile: 16-24px, Tablet: 40px, Desktop: 60-100px)
4. âœ… ìµœëŒ€ ë„ˆë¹„ ì œí•œì„ ì¶”ê°€í•˜ëŠ”ê°€? (Tablet: 700-1200px, Desktop: 900-1400px)
5. âœ… `SingleChildScrollView`ë¡œ ìŠ¤í¬ë¡¤ì„ ì§€ì›í•˜ëŠ”ê°€?
6. âœ… ì½˜í…ì¸ ë¥¼ `Center`ì™€ `ConstrainedBox`ë¡œ ê°ì‹¸ëŠ”ê°€?

### ğŸ“š ì°¸ê³  ìë£Œ

- ê³µí†µ ìœ í‹¸ë¦¬í‹°: `lib/utils/responsive_helper.dart`
- ê³µí†µ ìœ„ì ¯: `lib/widgets/responsive_screen.dart`, `lib/widgets/responsive_container.dart`
- ê°€ì´ë“œ ë¬¸ì„œ: `docs/responsive-builder-implementation-guide.md`
- ìµœì¢… ë³´ê³ ì„œ: `docs/responsive-builder-final-report.md`

**ì¤‘ìš”:**
- ëª¨ë“  ìƒˆë¡œìš´ ìŠ¤í¬ë¦°ì€ **ë°˜ë“œì‹œ ResponsiveBuilderë¥¼ ì‚¬ìš©**í•´ì•¼ í•©ë‹ˆë‹¤
- ê¸°ì¡´ ìŠ¤í¬ë¦°ë„ í•„ìš” ì‹œ ResponsiveBuilderë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•´ì•¼ í•©ë‹ˆë‹¤
- í‘œì¤€ íŒ¨í„´ì„ ë”°ë¼ ì¼ê´€ëœ ì‚¬ìš©ì ê²½í—˜ì„ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤

## ë‹¤ë¥¸ ìŠ¤í¬ë¦°ì— ìˆ˜ì •ì‚¬í•­ ë°˜ì˜

**ì›ì¹™**: í•˜ìœ„ í™”ë©´ì—ì„œ ë°ì´í„° ìˆ˜ì • í›„ ìƒìœ„ í™”ë©´ìœ¼ë¡œ ëŒì•„ì˜¬ ë•Œ ë³€ê²½ì‚¬í•­ì´ ìë™ìœ¼ë¡œ ë°˜ì˜ë˜ì–´ì•¼ í•¨

### âœ… ì˜¬ë°”ë¥¸ ë°©ë²•

**1. ìˆ˜ì •/ìƒì„± í™”ë©´ì—ì„œ ë°˜í™˜ê°’ ì „ë‹¬**
```dart
// ìˆ˜ì •/ìƒì„± ì„±ê³µ ì‹œ
if (response.success && response.data != null) {
  context.pop(response.data);  // ìˆ˜ì •ëœ ê°ì²´ ë°˜í™˜
} else {
  context.pop(true);  // ë˜ëŠ” true ë°˜í™˜í•˜ì—¬ ìƒˆë¡œê³ ì¹¨ í•„ìš”í•¨ì„ ì•Œë¦¼
}
```

**2. ìƒìœ„ í™”ë©´ì—ì„œ ë°˜í™˜ê°’ ì²˜ë¦¬ (async/await íŒ¨í„´)**
```dart
Future<void> _navigateToEditScreen(String id) async {
  final result = await context.push('/edit/$id');
  
  if (!mounted) return;
  
  // ë°˜í™˜ê°’ì´ ìˆìœ¼ë©´ ìƒˆë¡œê³ ì¹¨
  if (result != null) {
    // Provider ë¬´íš¨í™” (Riverpod)
    ref.invalidate(dataProvider(id));
    
    // ë˜ëŠ” ì§ì ‘ ìƒˆë¡œê³ ì¹¨
    await _loadData();
    
    // ë³€ê²½ì‚¬í•­ í”Œë˜ê·¸ ì„¤ì • (ë’¤ë¡œê°€ê¸° ì‹œ ìƒìœ„ í™”ë©´ë„ ìƒˆë¡œê³ ì¹¨)
    setState(() {
      _hasChanges = true;
    });
  }
}
```

**3. ë’¤ë¡œê°€ê¸° ì‹œ ìƒìœ„ í™”ë©´ ìƒˆë¡œê³ ì¹¨**
```dart
// ë’¤ë¡œê°€ê¸° ë²„íŠ¼
leading: IconButton(
  icon: const Icon(Icons.arrow_back),
  onPressed: () {
    context.pop(_hasChanges ? true : null);
  },
),

// ìƒìœ„ í™”ë©´ì—ì„œ ì²˜ë¦¬
context.push('/detail/$id').then((result) {
  if (result == true) {
    _loadData();  // ìƒˆë¡œê³ ì¹¨
  }
});
```

**4. Provider ì‚¬ìš© ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨**
```dart
// Provider ë¬´íš¨í™”ë¡œ ìë™ ìƒˆë¡œê³ ì¹¨
ref.invalidate(campaignDetailProvider(campaignId));

// ì•½ê°„ì˜ ì§€ì—° í›„ ì¬ë¬´íš¨í™” (DB íŠ¸ëœì­ì…˜ ì»¤ë°‹ ëŒ€ê¸°)
await Future.delayed(const Duration(milliseconds: 300));
if (mounted) {
  ref.invalidate(campaignDetailProvider(campaignId));
}
```

### âŒ ì˜ëª»ëœ ë°©ë²•

```dart
// âŒ ë°˜í™˜ê°’ì„ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
void _navigateToEdit() {
  context.push('/edit');  // ë°˜í™˜ê°’ ë¬´ì‹œ
}

// âŒ ìˆ˜ì • í›„ ë°˜í™˜ê°’ì„ ì „ë‹¬í•˜ì§€ ì•ŠìŒ
if (response.success) {
  context.pop();  // âŒ ë°˜í™˜ê°’ ì—†ìŒ
}

// âŒ Provider ë¬´íš¨í™” ì—†ì´ ìˆ˜ì •
// ìˆ˜ì • í›„ì—ë„ ì´ì „ ë°ì´í„°ê°€ í‘œì‹œë¨
```

**ì°¸ê³  ì˜ˆì‹œ:**
- ìº í˜ì¸ í¸ì§‘: `lib/screens/mypage/advertiser/advertiser_campaign_detail_screen.dart`ì˜ `_handleEdit` ë©”ì„œë“œ
- ìº í˜ì¸ ìƒì„±: `lib/screens/mypage/advertiser/advertiser_my_campaigns_screen.dart`ì˜ `_navigateToCreateCampaign` ë©”ì„œë“œ